<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.5"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.5"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><title>尚硅谷书城项目 | realheisenberg</title><meta name="generator" content="Hexo 5.2.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">尚硅谷书城项目</h1><a id="logo" href="/.">realheisenberg</a><p class="description">liusai201@mails.ucas.ac.cn</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="search"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">尚硅谷书城项目</h1><div class="post-meta"><a href="/2021/05/08/%E5%B0%9A%E7%A1%85%E8%B0%B7%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE/#comments" class="comment-count"></a><p><span class="date">May 08, 2021</span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>Hits</i></i></span></p></div><div class="post-content"><h3 id="一-表单验证"><a href="#一-表单验证" class="headerlink" title="一. 表单验证"></a>一. 表单验证</h3><p>验证用户名：必须由字母，数字下划线组成，并且长度为5 到12 位<br>验证密码：必须由字母，数字下划线组成，并且长度为5 到12 位<br>验证确认密码：和密码相同<br>邮箱验证：<a href="mailto:&#x78;&#x78;&#x78;&#x78;&#x78;&#x40;&#120;&#120;&#120;&#x2e;&#99;&#111;&#x6d;">&#x78;&#x78;&#x78;&#x78;&#x78;&#x40;&#120;&#120;&#120;&#x2e;&#99;&#111;&#x6d;</a><br>验证码：现在只需要验证用户已输入。因为还没讲到服务器。验证码生成。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>尚硅谷会员注册页面<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">link</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;../../static/css/style.css&quot;</span> &gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../../static/script/jquery-1.7.2.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">		$(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="comment">//给注册绑定单击事件</span></span></span><br><span class="line"><span class="javascript">			$(<span class="string">&quot;#sub_btn&quot;</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">				<span class="comment">//验证用户名：由字母、数字、下划线组成，长度5~12位</span></span></span><br><span class="line"><span class="javascript">				<span class="comment">//1. 获取输入框内容</span></span></span><br><span class="line"><span class="javascript">				<span class="keyword">var</span> usernameText = $(<span class="string">&quot;#username&quot;</span>).val();</span></span><br><span class="line"><span class="javascript">				<span class="comment">//2. 创建正则表达式对象</span></span></span><br><span class="line"><span class="javascript">				<span class="keyword">var</span> usernamePatt = <span class="regexp">/^\w&#123;5,12&#125;$/</span>;</span></span><br><span class="line"><span class="javascript">				<span class="comment">//3. 使用test方法验证</span></span></span><br><span class="line">				if (!usernamePatt.test(usernameText))&#123;</span><br><span class="line"><span class="javascript">					<span class="comment">//4. 提示用户结果</span></span></span><br><span class="line"><span class="javascript">					$(<span class="string">&quot;span.errorMsg&quot;</span>).text(<span class="string">&quot;用户名不合法！&quot;</span>);</span></span><br><span class="line"><span class="javascript">					<span class="keyword">return</span> <span class="literal">false</span>;		<span class="comment">//不跳转</span></span></span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">				<span class="comment">//验证密码：必须由字母、数字、下划线组成，长度5~12位</span></span></span><br><span class="line"><span class="javascript">				<span class="comment">//1. 获取输入框内容</span></span></span><br><span class="line"><span class="javascript">				<span class="keyword">var</span> passwordText = $(<span class="string">&quot;#password&quot;</span>).val();</span></span><br><span class="line"><span class="javascript">				<span class="comment">//2. 创建正则表达式对象</span></span></span><br><span class="line"><span class="javascript">				<span class="keyword">var</span> passwordPatt = <span class="regexp">/^\w&#123;5,12&#125;$/</span>;</span></span><br><span class="line"><span class="javascript">				<span class="comment">//3. 使用test方法验证</span></span></span><br><span class="line">				if (!passwordPatt.test(passwordText))&#123;</span><br><span class="line"><span class="javascript">					$(<span class="string">&quot;span.errorMsg&quot;</span>).text(<span class="string">&quot;密码不合法！&quot;</span>);</span></span><br><span class="line"><span class="javascript">					<span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">				<span class="comment">//验证确认密码是否与密码相同</span></span></span><br><span class="line"><span class="javascript">				<span class="comment">//1. 获取确认密码内容</span></span></span><br><span class="line"><span class="javascript">				<span class="keyword">var</span> repwdText = $(<span class="string">&quot;#repwd&quot;</span>).val();</span></span><br><span class="line"><span class="javascript">				<span class="comment">//2. 与密码比较</span></span></span><br><span class="line">				if (repwdText != passwordText)&#123;</span><br><span class="line"><span class="javascript">					$(<span class="string">&quot;span.errorMsg&quot;</span>).text(<span class="string">&quot;确认密码与密码不一致！&quot;</span>);</span></span><br><span class="line"><span class="javascript">					<span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">				<span class="comment">//邮箱验证</span></span></span><br><span class="line"><span class="javascript">				<span class="comment">//1. 获取邮箱内容</span></span></span><br><span class="line"><span class="javascript">				<span class="keyword">var</span> emailText = $(<span class="string">&quot;#email&quot;</span>).val();</span></span><br><span class="line"><span class="javascript">				<span class="comment">//2. 创建正则表达式对象</span></span></span><br><span class="line"><span class="javascript">				<span class="keyword">var</span> emailPatt = <span class="regexp">/^[a-z\d]+(\.[a-z\d]+)*@([\da-z](-[\da-z])?)+(\.&#123;1,2&#125;[a-z]+)+$/</span>;</span></span><br><span class="line"><span class="javascript">				<span class="comment">//3. 使用test方法验证</span></span></span><br><span class="line">				if (!emailPatt.test(emailText))&#123;</span><br><span class="line"><span class="javascript">					$(<span class="string">&quot;span.errorMsg&quot;</span>).text(<span class="string">&quot;邮箱格式不合法！&quot;</span>);</span></span><br><span class="line"><span class="javascript">					<span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">				<span class="comment">//验证码（只要求用户已输入）</span></span></span><br><span class="line"><span class="javascript">				<span class="keyword">var</span> codeText = $(<span class="string">&quot;#code&quot;</span>).val();</span></span><br><span class="line"><span class="javascript">				<span class="comment">//去掉验证码前后空格</span></span></span><br><span class="line"><span class="javascript">				codeText = $.trim(codeText);</span></span><br><span class="line"><span class="javascript">				<span class="keyword">if</span> (codeText == <span class="literal">null</span> || codeText == <span class="string">&quot;&quot;</span>)&#123;</span></span><br><span class="line"><span class="javascript">					$(<span class="string">&quot;span.errorMsg&quot;</span>).text(<span class="string">&quot;验证码不能为空！&quot;</span>);</span></span><br><span class="line"><span class="javascript">					<span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">				$(<span class="string">&quot;span.errorMsg&quot;</span>).text(<span class="string">&quot;&quot;</span>);		<span class="comment">//全部合法显示空白</span></span></span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;);</span><br><span class="line">	<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span></span><br><span class="line"><span class="css">		<span class="selector-class">.login_form</span>&#123;</span></span><br><span class="line"><span class="css">			<span class="selector-tag">height</span><span class="selector-pseudo">:420px</span>;</span></span><br><span class="line">			margin-top: 25px;</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;login_header&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;logo_img&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../../static/img/logo.gif&quot;</span> &gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;login_banner&quot;</span>&gt;</span></span><br><span class="line">			</span><br><span class="line">				<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;l_content&quot;</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;login_word&quot;</span>&gt;</span>欢迎注册<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">				</span><br><span class="line">				<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;login_form&quot;</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;login_box&quot;</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;tit&quot;</span>&gt;</span></span><br><span class="line">								<span class="tag">&lt;<span class="name">h1</span>&gt;</span>注册尚硅谷会员<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">								<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;errorMsg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form&quot;</span>&gt;</span></span><br><span class="line">								<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;regist_success.html&quot;</span>&gt;</span></span><br><span class="line">									<span class="tag">&lt;<span class="name">label</span>&gt;</span>用户名称：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">									<span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;itxt&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入用户名&quot;</span></span></span><br><span class="line"><span class="tag">										   <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> <span class="attr">tabindex</span>=<span class="string">&quot;1&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> /&gt;</span></span><br><span class="line">									<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">									<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">									<span class="tag">&lt;<span class="name">label</span>&gt;</span>用户密码：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">									<span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;itxt&quot;</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入密码&quot;</span></span></span><br><span class="line"><span class="tag">										   <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> <span class="attr">tabindex</span>=<span class="string">&quot;1&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span> /&gt;</span></span><br><span class="line">									<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">									<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">									<span class="tag">&lt;<span class="name">label</span>&gt;</span>确认密码：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">									<span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;itxt&quot;</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;确认密码&quot;</span></span></span><br><span class="line"><span class="tag">										   <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> <span class="attr">tabindex</span>=<span class="string">&quot;1&quot;</span> <span class="attr">name</span>=<span class="string">&quot;repwd&quot;</span> <span class="attr">id</span>=<span class="string">&quot;repwd&quot;</span> /&gt;</span></span><br><span class="line">									<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">									<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">									<span class="tag">&lt;<span class="name">label</span>&gt;</span>电子邮件：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">									<span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;itxt&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入邮箱地址&quot;</span></span></span><br><span class="line"><span class="tag">										   <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> <span class="attr">tabindex</span>=<span class="string">&quot;1&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">id</span>=<span class="string">&quot;email&quot;</span> /&gt;</span></span><br><span class="line">									<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">									<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">									<span class="tag">&lt;<span class="name">label</span>&gt;</span>验证码：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">									<span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;itxt&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 150px;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;code&quot;</span>/&gt;</span></span><br><span class="line">									<span class="tag">&lt;<span class="name">img</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../../static/img/code.bmp&quot;</span> <span class="attr">style</span>=<span class="string">&quot;float: right; margin-right: 40px&quot;</span>&gt;</span>									</span><br><span class="line">									<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">									<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">									<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;注册&quot;</span> <span class="attr">id</span>=<span class="string">&quot;sub_btn&quot;</span> /&gt;</span></span><br><span class="line">									</span><br><span class="line">								<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">							</span><br><span class="line">						<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;bottom&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">				尚硅谷书城.Copyright <span class="symbol">&amp;copy;</span>2015</span><br><span class="line">			<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="二-用户注册和登录"><a href="#二-用户注册和登录" class="headerlink" title="二. 用户注册和登录"></a>二. 用户注册和登录</h3><p>JavaEE三层架构：</p>
<p>Web层/视图展现层：</p>
<ol>
<li>获取请求参数，封装成Bean对象</li>
<li>调用Service层处理业务</li>
<li>响应数据给客户端（请求转发、重定向）</li>
<li>技术：Servlet程序、Webwork、Strtus1.x、Strtus2.x、SpringMVC</li>
</ol>
<p>Service业务层：</p>
<ol>
<li>处理业务逻辑</li>
<li>调用持久层保存到数据库</li>
<li>技术：Spring框架</li>
</ol>
<p>Dao持久层：</p>
<ol>
<li>持久层只负责与数据库交互（CRUD）</li>
<li>技术：JDBC、DbUtils、JdbcTemplate、Mybatis、Hibernate、JPA</li>
</ol>
<p>分层的目的在于解耦合，方便项目后期的维护和升级</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>包名</th>
<th>属性</th>
</tr>
</thead>
<tbody><tr>
<td>Web层</td>
<td>web/servlet/controller</td>
<td></td>
</tr>
<tr>
<td>Service层</td>
<td>service</td>
<td>Service接口包</td>
</tr>
<tr>
<td></td>
<td>service.impl</td>
<td>Service接口实现类</td>
</tr>
<tr>
<td>Dao持久层</td>
<td>dao</td>
<td>Dao接口包</td>
</tr>
<tr>
<td></td>
<td>dao.impl</td>
<td>Dao接口实现类</td>
</tr>
<tr>
<td>实体Bean对象</td>
<td>pojo/entity/domain/bean</td>
<td>JavaBean类</td>
</tr>
<tr>
<td>测试包</td>
<td>test/junit</td>
<td></td>
</tr>
<tr>
<td>工具类</td>
<td>utils</td>
<td></td>
</tr>
</tbody></table>
<p>创建数据库和表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">drop database if exists book;</span><br><span class="line">create database book;</span><br><span class="line">use book;</span><br><span class="line">create table t_user(</span><br><span class="line">	&#96;id&#96; int primary key auto_increment,</span><br><span class="line">	&#96;username&#96; varchar(20) not null unique,</span><br><span class="line">	&#96;password&#96; varchar(32) not null,</span><br><span class="line">	&#96;email&#96; varchar(200)</span><br><span class="line">);</span><br><span class="line">insert into t_user(&#96;username&#96;,&#96;password&#96;,&#96;email&#96;) values(&#39;admin&#39;,&#39;admin&#39;,&#39;admin@163.com&#39;);</span><br></pre></td></tr></table></figure>

<p>编写数据库表对应的JavaBean对象：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="comment">//setter、getter、toString、有参无参构造</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="编写工具类JdbcUtils"><a href="#编写工具类JdbcUtils" class="headerlink" title="编写工具类JdbcUtils"></a>编写工具类JdbcUtils</h4><p>导入jar包：druid-1.1.9.jar、mysql-connector-java-5.1.7-bin.jar、hamcrest-core-1.3.jar、junit-4.12.jar</p>
<p>在src下编写jdbc.properties属性配置文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">username&#x3D;root</span><br><span class="line">password&#x3D;root</span><br><span class="line">url&#x3D;jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;book</span><br><span class="line">driverClassName&#x3D;com.mysql.jdbc.Driver</span><br><span class="line">initialSize&#x3D;5</span><br><span class="line">maxActive&#x3D;10</span><br></pre></td></tr></table></figure>

<p>编写JdbcUtils工具类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSourceFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcUtils</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DruidDataSource dataSource;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">            InputStream inputStream = JdbcUtils.class.getClassLoader().getResourceAsStream(<span class="string">&quot;jdbc.properties&quot;</span>);</span><br><span class="line">            properties.load(inputStream);</span><br><span class="line">            <span class="comment">//创建数据库连接池</span></span><br><span class="line">            dataSource = (DruidDataSource) DruidDataSourceFactory.createDataSource(properties);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取数据库连接池中的连接，返回null表示获取连接失败</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = dataSource.getConnection();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> conn;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//关闭连接，放回数据库连接池</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(Connection conn)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (conn != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                conn.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="编写BaseDao"><a href="#编写BaseDao" class="headerlink" title="编写BaseDao"></a>编写BaseDao</h4><p>导入DBUtils的jar包：commons-dbutils-1.3.jar</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.dbutils.QueryRunner;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbutils.handlers.BeanHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbutils.handlers.BeanListHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbutils.handlers.ScalarHandler;</span><br><span class="line"><span class="keyword">import</span> utils.JdbcUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseDao</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> QueryRunner queryRunner = <span class="keyword">new</span> QueryRunner();</span><br><span class="line">    <span class="comment">//update()方法用来执行Insert/Update/Delete语句</span></span><br><span class="line">	<span class="comment">//返回-1表示执行失败，返回其他表示影响的行数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">update</span><span class="params">(String sql, Object... args)</span></span>&#123;</span><br><span class="line">        Connection conn = JdbcUtils.getConnection();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> queryRunner.update(conn, sql, args);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            JdbcUtils.close(conn);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询返回一个javaBean的sql语句</span></span><br><span class="line">    <span class="comment">//type：返回的对象类型，args：sql对应的参数值</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">queryForOne</span><span class="params">(Class&lt;T&gt; type, String sql, Object... args)</span></span>&#123;</span><br><span class="line">        Connection conn = JdbcUtils.getConnection();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> queryRunner.query(conn, sql, <span class="keyword">new</span> BeanHandler&lt;T&gt;(type), args);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            JdbcUtils.close(conn);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询返回多个javaBean的sql语句</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">List&lt;T&gt; <span class="title">queryForList</span><span class="params">(Class&lt;T&gt; type, String sql, Object... args)</span></span>&#123;</span><br><span class="line">        Connection conn = JdbcUtils.getConnection();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> queryRunner.query(conn, sql, <span class="keyword">new</span> BeanListHandler&lt;T&gt;(type), args);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            JdbcUtils.close(conn);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//执行返回一行一列的sql语句</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">queryForSingleValue</span><span class="params">(String sql, Object... args)</span></span>&#123;</span><br><span class="line">        Connection conn = JdbcUtils.getConnection();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> queryRunner.query(conn, sql, <span class="keyword">new</span> ScalarHandler(), args);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            JdbcUtils.close(conn);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="编写UserDao接口"><a href="#编写UserDao接口" class="headerlink" title="编写UserDao接口"></a>编写UserDao接口</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="comment">//跟据用户名查询用户信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">queryUserByUsername</span><span class="params">(String username)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据用户名和密码查询用户</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">queryUserByUsernameAndPassword</span><span class="params">(String username, String password)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//保存用户信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">saveUser</span><span class="params">(User user)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UserDaoImpl实现类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoImpl</span> <span class="keyword">extends</span> <span class="title">BaseDao</span> <span class="keyword">implements</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">queryUserByUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;select `id`,`username`,`password`,`email` from t_user where username = ?&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> queryForOne(User.class, sql, username);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">queryUserByUsernameAndPassword</span><span class="params">(String username, String password)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;select `id`,`username`,`password`,`email` from t_user where username = ? and password = ?&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> queryForOne(User.class, sql, username, password);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">saveUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;insert into t_user(`username`,`password`,`email`) values(?,?,?)&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> update(sql, user.getUsername(),user.getPassword(),user.getEmail());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="编写UserService接口"><a href="#编写UserService接口" class="headerlink" title="编写UserService接口"></a>编写UserService接口</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="comment">//注册</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//登录</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">login</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//检查用户名是否可用，返回true表示用户名已存在，不可用</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">existUsername</span><span class="params">(String username)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UserServiceImpl实现类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> dao.impl.UserDaoImpl;</span><br><span class="line"><span class="keyword">import</span> pojo.User;</span><br><span class="line"><span class="keyword">import</span> service.UserService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> UserDao userDao = <span class="keyword">new</span> UserDaoImpl();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        userDao.saveUser(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">login</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userDao.queryUserByUsernameAndPassword(user.getUsername(), user.getPassword());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">existUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (userDao.queryUserByUsername(username) == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="编写web层：实现用户注册功能"><a href="#编写web层：实现用户注册功能" class="headerlink" title="编写web层：实现用户注册功能"></a>编写web层：实现用户注册功能</h4><p>用户输入完成，点击提交，把数据发送给服务器</p>
<p>服务器RegistServlet程序：</p>
<ol>
<li>获取请求参数</li>
<li>检查验证码是否正确</li>
<li>验证码正确，检查用户名是否可用</li>
<li>用户名可用，跳转到注册成功页面</li>
</ol>
<p>使用base标签+相对路径的方式，修改regist.html与regist_success.html页面</p>
<p>修改注册表单的提交地址和请求方式：<code>&lt;form action=&quot;registServlet&quot; method=&quot;post&quot;&gt;</code></p>
<p>编写RegistServlet程序：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RegistServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> UserService userService = <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//1. 获取请求参数</span></span><br><span class="line">        String username = request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        String password = request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        String email = request.getParameter(<span class="string">&quot;email&quot;</span>);</span><br><span class="line">        String code = request.getParameter(<span class="string">&quot;code&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 检查验证码是否正确（先写死，abcde）</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;abcde&quot;</span>.equalsIgnoreCase(code)) &#123;      <span class="comment">//忽略大小写</span></span><br><span class="line">            <span class="keyword">if</span> (userService.existUsername(username)) &#123;</span><br><span class="line">                <span class="comment">//该用户名已被注册，跳转到注册页面</span></span><br><span class="line">                request.getRequestDispatcher(<span class="string">&quot;/pages/user/regist.html&quot;</span>).forward(request, response);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//该用户名未被使用，保存到数据库注册成功</span></span><br><span class="line">                userService.registUser(<span class="keyword">new</span> User(<span class="keyword">null</span>, username, password, email));</span><br><span class="line">                request.getRequestDispatcher(<span class="string">&quot;/pages/user/regist_success.html&quot;</span>).forward(request, response);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            request.getRequestDispatcher(<span class="string">&quot;/pages/user/regist.html&quot;</span>).forward(request, response);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="实现用户登录功能"><a href="#实现用户登录功能" class="headerlink" title="实现用户登录功能"></a>实现用户登录功能</h4><p>修改login.html和login_success.html页面路径</p>
<p>修改login.html表单的提交地址和请求方式：<code>&lt;form action=&quot;loginServlet&quot; method=&quot;post&quot;&gt;</code></p>
<p>编写LoginServlet程序：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> UserService userService = <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//获取请求参数</span></span><br><span class="line">        String username = req.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        String password = req.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        User login = userService.login(<span class="keyword">new</span> User(<span class="keyword">null</span>, username, password, <span class="keyword">null</span>));</span><br><span class="line">        <span class="comment">//返回null说明登录失败</span></span><br><span class="line">        <span class="keyword">if</span> (login == <span class="keyword">null</span>)&#123;</span><br><span class="line">            req.getRequestDispatcher(<span class="string">&quot;/pages/user/login.html&quot;</span>).forward(req, resp);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            req.getRequestDispatcher(<span class="string">&quot;/pages/user/login_success.html&quot;</span>).forward(req, resp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="三-项目优化"><a href="#三-项目优化" class="headerlink" title="三. 项目优化"></a>三. 项目优化</h3><p>页面jsp动态化：</p>
<ol>
<li>在html页面首行添加page指令</li>
<li>修改文件后缀为.jsp</li>
<li>使用IDEA搜索替换.html为.jsp（快捷键：Ctrl+Shift+R）</li>
</ol>
<h4 id="抽取页面中相同内容"><a href="#抽取页面中相同内容" class="headerlink" title="抽取页面中相同内容"></a>抽取页面中相同内容</h4><p>登陆成功后的菜单：login_success_menu.jsp</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">    &lt;span&gt;欢迎&lt;span class=&quot;um_span&quot;&gt;韩总&lt;/span&gt;光临尚硅谷书城&lt;/span&gt;</span><br><span class="line">    &lt;a href=&quot;pages/order/order.jsp&quot;&gt;我的订单&lt;/a&gt;</span><br><span class="line">    &lt;a href=&quot;index.jsp&quot;&gt;注销&lt;/a&gt;&amp;nbsp;&amp;nbsp;</span><br><span class="line">    &lt;a href=&quot;index.jsp&quot;&gt;返回&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>head中css、jQuery、base标签：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%-- 动态获取地址： --%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    String basePath = request.getScheme()</span><br><span class="line">            + <span class="string">&quot;://&quot;</span></span><br><span class="line">            + request.getServerName()</span><br><span class="line">            + <span class="string">&quot;:&quot;</span></span><br><span class="line">            + request.getServerPort()</span><br><span class="line">            + request.getContextPath()</span><br><span class="line">            + <span class="string">&quot;/&quot;</span>;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;base href=<span class="string">&quot;&lt;%=basePath%&gt;&gt;&quot;</span>&gt;</span><br><span class="line">&lt;link type=<span class="string">&quot;text/css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;static/css/style.css&quot;</span> &gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;static/script/jquery-1.7.2.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>foot中包含页脚信息：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">&quot;bottom&quot;</span>&gt;</span><br><span class="line">	&lt;span&gt;</span><br><span class="line">		尚硅谷书城.Copyright &amp;copy;<span class="number">2015</span></span><br><span class="line">	&lt;/span&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>manager_menu管理模块菜单：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">    &lt;a href=&quot;pages/manager/book_manager.jsp&quot;&gt;图书管理&lt;/a&gt;</span><br><span class="line">    &lt;a href=&quot;pages/manager/order_manager.jsp&quot;&gt;订单管理&lt;/a&gt;</span><br><span class="line">    &lt;a href=&quot;index.jsp&quot;&gt;返回商城&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h4 id="错误信息提示及表单回显"><a href="#错误信息提示及表单回显" class="headerlink" title="错误信息提示及表单回显"></a>错误信息提示及表单回显</h4><p>LoginServlet.java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (login == <span class="keyword">null</span>)&#123;</span><br><span class="line">	<span class="comment">//把错误信息和表单项信息保存到Request域中</span></span><br><span class="line">	req.setAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;用户名或密码错误！&quot;</span>);</span><br><span class="line">	req.setAttribute(<span class="string">&quot;username&quot;</span>, username);</span><br><span class="line">	<span class="comment">//跳回登录页面</span></span><br><span class="line">	req.getRequestDispatcher(<span class="string">&quot;/pages/user/login.jsp&quot;</span>).forward(req, resp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>login.jsp：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;errorMsg&quot;</span>&gt;</span><br><span class="line">	&lt;%=request.getAttribute(<span class="string">&quot;msg&quot;</span>) == <span class="keyword">null</span> ? <span class="string">&quot;请输入用户名和密码&quot;</span> : request.getAttribute(<span class="string">&quot;msg&quot;</span>)%&gt;</span><br><span class="line">&lt;/span&gt;</span><br><span class="line"></span><br><span class="line">&lt;input <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;itxt&quot;</span> type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span> value=</span><br><span class="line"><span class="string">&quot;&lt;%=request.getAttribute(&quot;</span>username<span class="string">&quot;) == null ? &quot;</span><span class="string">&quot; : request.getAttribute(&quot;</span>username<span class="string">&quot;)%&gt;&quot;</span></span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<p>同理，修改RegistServlet.java与regist.jsp</p>
<h4 id="合并LoginServlet和RegistServlet为UserServlet"><a href="#合并LoginServlet和RegistServlet为UserServlet" class="headerlink" title="合并LoginServlet和RegistServlet为UserServlet"></a>合并LoginServlet和RegistServlet为UserServlet</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> UserService userService = <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        String action = req.getParameter(<span class="string">&quot;action&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;login&quot;</span>.equals(action))&#123;</span><br><span class="line">            login(req, resp);		<span class="comment">//login方法复制LoginServlet</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;regist&quot;</span>.equals(action))&#123;</span><br><span class="line">            regist(req, resp);		<span class="comment">//regist方法复制RegistServlet</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>设置隐藏域</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;form&quot;</span>&gt;</span><br><span class="line">&lt;form action=<span class="string">&quot;userServlet&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;action&quot;</span> value=<span class="string">&quot;login&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;form&quot;</span>&gt;</span><br><span class="line">&lt;form action=<span class="string">&quot;registServlet&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;action&quot;</span> value=<span class="string">&quot;regist&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>

<h4 id="使用反射优化UserServlet中的else-if代码"><a href="#使用反射优化UserServlet中的else-if代码" class="headerlink" title="使用反射优化UserServlet中的else if代码"></a>使用反射优化UserServlet中的else if代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">	String action = req.getParameter(<span class="string">&quot;action&quot;</span>);</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		Method method = <span class="keyword">this</span>.getClass().getDeclaredMethod(action, HttpServletRequest.class, HttpServletResponse.class);</span><br><span class="line">		method.invoke(<span class="keyword">this</span>, req, resp);</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="抽取BaseServlet程序"><a href="#抽取BaseServlet程序" class="headerlink" title="抽取BaseServlet程序"></a>抽取BaseServlet程序</h4><p>以后所有的Servlet程序继承BaseServlet即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//解决post请求中文乱码问题，必须在获取请求参数之前使用</span></span><br><span class="line">        req.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        String action = req.getParameter(<span class="string">&quot;action&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Method method = <span class="keyword">this</span>.getClass().getDeclaredMethod(action, HttpServletRequest.class, HttpServletResponse.class);</span><br><span class="line">            method.invoke(<span class="keyword">this</span>, req, resp);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="数据的封装和BeanUtils的使用"><a href="#数据的封装和BeanUtils的使用" class="headerlink" title="数据的封装和BeanUtils的使用"></a>数据的封装和BeanUtils的使用</h4><p>BeanUtils工具类可以一次性把所有请求的参数以Map的形式注入到JavaBean中</p>
<p>导入jar包：commons-beanutils-1.8.0.jar、commons-logging-1.1.1.jar</p>
<p>WebUtils工具类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebUtils</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">copyParamToBean</span><span class="params">(Map value, T bean)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            BeanUtils.populate(bean, value);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UserServlet中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User user = WebUtils.copyParamToBean(req.getParameterMap(), <span class="keyword">new</span> User());</span><br></pre></td></tr></table></figure>

<h4 id="使用EL表达式修改表单回显"><a href="#使用EL表达式修改表单回显" class="headerlink" title="使用EL表达式修改表单回显"></a>使用EL表达式修改表单回显</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value&#x3D;&quot;$&#123;requestScope.username&#125;&quot;</span><br></pre></td></tr></table></figure>



<h3 id="四-图书模块"><a href="#四-图书模块" class="headerlink" title="四. 图书模块"></a>四. 图书模块</h3><h4 id="1-编写图书模块数据库、表"><a href="#1-编写图书模块数据库、表" class="headerlink" title="1.编写图书模块数据库、表"></a>1.编写图书模块数据库、表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_book(</span><br><span class="line">	<span class="string">`id`</span> <span class="built_in">int</span> primary <span class="keyword">key</span> auto_increment,</span><br><span class="line">    <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">100</span>),</span><br><span class="line">    <span class="string">`price`</span> <span class="built_in">decimal</span>(<span class="number">11</span>,<span class="number">2</span>),</span><br><span class="line">    <span class="string">`author`</span> <span class="built_in">varchar</span>(<span class="number">100</span>),</span><br><span class="line">    <span class="string">`sales`</span> <span class="built_in">int</span>,</span><br><span class="line">    <span class="string">`stock`</span> <span class="built_in">int</span>,</span><br><span class="line">    <span class="string">`img_path`</span> <span class="built_in">varchar</span>(<span class="number">200</span>)</span><br><span class="line">);</span><br><span class="line"><span class="comment">##插入测试数据</span></span><br></pre></td></tr></table></figure>

<p>MySql插入中文时报错ERROR 1366 (HY000)解决办法：</p>
<p>修改MySql配置文件my.ini，将default-character-set=由utf8改为gbk</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_34110501/article/details/77504716">https://blog.csdn.net/qq_34110501/article/details/77504716</a></p>
<h4 id="编写图书模块的JavaBean"><a href="#编写图书模块的JavaBean" class="headerlink" title="编写图书模块的JavaBean"></a>编写图书模块的JavaBean</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String author;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    <span class="keyword">private</span> Integer sales;</span><br><span class="line">    <span class="keyword">private</span> Integer stock;</span><br><span class="line">    <span class="keyword">private</span> String imgPath = <span class="string">&quot;static/img/default.jpg&quot;</span>;</span><br><span class="line">    <span class="comment">//有参无参构造、toString、setter、getter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="编写图书模块的Dao与测试"><a href="#编写图书模块的Dao与测试" class="headerlink" title="编写图书模块的Dao与测试"></a>编写图书模块的Dao与测试</h4><p>BookDao接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BookDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">addBook</span><span class="params">(Book book)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">deleteBookById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">updateBook</span><span class="params">(Book book)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Book <span class="title">queryBookById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Book&gt; <span class="title">queryBooks</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BookDaoImpl实现类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookDaoImpl</span> <span class="keyword">extends</span> <span class="title">BaseDao</span> <span class="keyword">implements</span> <span class="title">BookDao</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">addBook</span><span class="params">(Book book)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;insert into t_book(`name`,`author`,`price`,`sales`,`stock`,`img_path`) values(?,?,?,?,?,?)&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> update(sql,book.getName(),book.getAuthor(),book.getPrice(),book.getSales(),book.getStock(),book.getImgPath());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">deleteBookById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;delete from t_book where id=?&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> update(sql, id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">updateBook</span><span class="params">(Book book)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;update t_book set `name`=?,`author`=?,`price`=?,`sales`=?,`stock`=?,`img_path`=? where id=?&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> update(sql,book.getName(),book.getAuthor(),book.getPrice(),book.getSales(),book.getStock(),book.getImgPath(),book.getId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Book <span class="title">queryBookById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;select `id`,`name`,`author`,`price`,`sales`,`stock`,`img_path` imgPath from t_book where id=?&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> queryForOne(Book.class, sql, id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Book&gt; <span class="title">queryBooks</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;select `id`,`name`,`author`,`price`,`sales`,`stock`,`img_path` imgPath from t_book&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> queryForList(Book.class, sql);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>生成测试类：快捷键Ctrl+Shift+T</p>
<h4 id="编写图书模块Service与测试"><a href="#编写图书模块Service与测试" class="headerlink" title="编写图书模块Service与测试"></a>编写图书模块Service与测试</h4><p>BookService接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addBook</span><span class="params">(Book book)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteBookById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateBook</span><span class="params">(Book book)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Book <span class="title">queryBookById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Book&gt; <span class="title">queryBooks</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BookServiceImpl实现类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookServiceImpl</span> <span class="keyword">implements</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> BookDao bookDao = <span class="keyword">new</span> BookDaoImpl();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addBook</span><span class="params">(Book book)</span> </span>&#123;</span><br><span class="line">        bookDao.addBook(book);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteBookById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        bookDao.deleteBookById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateBook</span><span class="params">(Book book)</span> </span>&#123;</span><br><span class="line">        bookDao.updateBook(book);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Book <span class="title">queryBookById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bookDao.queryBookById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Book&gt; <span class="title">queryBooks</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bookDao.queryBooks();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="编写Web层"><a href="#编写Web层" class="headerlink" title="编写Web层"></a>编写Web层</h4><p>BookServle程序添加list方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookServlet</span> <span class="keyword">extends</span> <span class="title">BaseServlet</span> </span>&#123;</span><br><span class="line">    BookService bookService = <span class="keyword">new</span> BookServiceImpl();</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">list</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//1. 通过BookService查询全部图书</span></span><br><span class="line">        List&lt;Book&gt; books = bookService.queryBooks();</span><br><span class="line">        <span class="comment">//2. 把全部图书保存到Request域中</span></span><br><span class="line">        req.setAttribute(<span class="string">&quot;books&quot;</span>, books);</span><br><span class="line">        <span class="comment">//3. 请求转发到/pages/manager/book_manager.jsp页面</span></span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;/pages/manager/book_manager.jsp&quot;</span>).forward(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>xml中配置地址为：/manager/bookServlet</p>
<p>修改book_manager.jsp页面：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:forEach items=<span class="string">&quot;$&#123;requestScope.books&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;book&quot;</span>&gt;</span><br><span class="line">	&lt;tr&gt;</span><br><span class="line">		&lt;td&gt;$&#123;book.name&#125;&lt;/td&gt;</span><br><span class="line">		&lt;td&gt;$&#123;book.price&#125;&lt;/td&gt;</span><br><span class="line">		&lt;td&gt;$&#123;book.author&#125;&lt;/td&gt;</span><br><span class="line">		&lt;td&gt;$&#123;book.sales&#125;&lt;/td&gt;</span><br><span class="line">		&lt;td&gt;$&#123;book.stock&#125;&lt;/td&gt;</span><br><span class="line">		&lt;td&gt;&lt;a href=&quot;book_edit.jsp&quot;&gt;修改&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">		&lt;td&gt;&lt;a href=&quot;#&quot;&gt;删除&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">	&lt;/tr&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>

<p>前台给普通用户使用，地址：/client/bookServlet</p>
<p>后台给管理员使用，地址：/manager/bookServlet</p>
<h4 id="添加图书"><a href="#添加图书" class="headerlink" title="添加图书"></a>添加图书</h4><p>BookServlet中添加add方法：</p>
<p>当用户提交完请求，浏览器会记录最后一次请求的信息，此时按F5，浏览器会发起记录的最后一次请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">	<span class="comment">//1. 获取请求参数，封装为Book对象</span></span><br><span class="line">	Book book = WebUtils.copyParamToBean(req.getParameterMap(),<span class="keyword">new</span> Book());</span><br><span class="line">	<span class="comment">//2. 调用BookService.addBook()保存图书</span></span><br><span class="line">	bookService.addBook(book);</span><br><span class="line">	<span class="comment">//3. 跳转到图书列表页面/manager/bookServlet?action=list</span></span><br><span class="line">    <span class="comment">//不能使用请求转发（一次请求），使用重定向（两次请求）</span></span><br><span class="line">	resp.sendRedirect(req.getContextPath() + <span class="string">&quot;/manager/bookServlet?action=list&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改book_edit.jsp页面：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">&quot;manager/bookServlet&quot;</span> method=<span class="string">&quot;get&quot;</span>&gt;</span><br><span class="line">	&lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;action&quot;</span> value=<span class="string">&quot;add&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>插入图书时中文显示乱码：</p>
<p>在BaseServlet的doPost方法的第一行添加：</p>
<p>req.setCharacterEncoding(“UTF-8”);</p>
<p>必须在获取请求参数之前使用</p>
</li>
</ul>
<h4 id="删除图书"><a href="#删除图书" class="headerlink" title="删除图书"></a>删除图书</h4><p>在WebUtils工具类中添加转换int类型工具方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">parseInt</span><span class="params">(String strInt, <span class="keyword">int</span> defaultValue)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> Integer.parseInt(strInt);</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> defaultValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BookServlet中添加delete方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">	<span class="comment">//1. 获取请求的id</span></span><br><span class="line">	<span class="keyword">int</span> id = WebUtils.parseInt(req.getParameter(<span class="string">&quot;id&quot;</span>), <span class="number">0</span>);</span><br><span class="line">	<span class="comment">//2. 调用bookService.deleteBookById()方法删除图书</span></span><br><span class="line">	bookService.deleteBookById(id);</span><br><span class="line">	<span class="comment">//3. 重定向</span></span><br><span class="line">	resp.sendRedirect(req.getContextPath() + <span class="string">&quot;/manager/bookServlet?action=list&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改删除键的链接地址：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;td&gt;&lt;a class=&quot;deleteClass&quot; href=&quot;manager/bookServlet?action=delete&amp;id=$&#123;book.id&#125;&quot;&gt;删除&lt;/a&gt;&lt;/td&gt;</span><br></pre></td></tr></table></figure>

<p>给删除添加提示操作：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">	$(function () &#123;</span><br><span class="line">		<span class="comment">//给a标签绑定单击事件</span></span><br><span class="line">		$(<span class="string">&quot;a.deleteClass&quot;</span>).click(function () &#123;</span><br><span class="line">			<span class="comment">//function函数的this对象是当前正在响应的dom对象</span></span><br><span class="line">			<span class="comment">//confirm是确认提示框函数，参数为提示内容，返回true表示确认，false表示取消</span></span><br><span class="line">			<span class="keyword">return</span> confirm(<span class="string">&quot;确认删除【&quot;</span> + $(<span class="keyword">this</span>).parent().parent().find(<span class="string">&quot;td:first&quot;</span>).text() + <span class="string">&quot;】？&quot;</span>);</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h4 id="修改图书信息"><a href="#修改图书信息" class="headerlink" title="修改图书信息"></a>修改图书信息</h4><p>更改修改按钮的请求地址：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;td&gt;&lt;a href=&quot;manager/bookServlet?action=getBook&amp;id=$&#123;book.id&#125;&quot;&gt;修改&lt;/a&gt;&lt;/td&gt;</span><br></pre></td></tr></table></figure>

<p>BookServlet中添加getBook方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">getBook</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">	<span class="comment">//1. 获取请求的图书编号</span></span><br><span class="line">	<span class="keyword">int</span> id = WebUtils.parseInt(req.getParameter(<span class="string">&quot;id&quot;</span>), <span class="number">0</span>);</span><br><span class="line">	<span class="comment">//2. 查询图书</span></span><br><span class="line">	Book book = bookService.queryBookById(id);</span><br><span class="line">	<span class="comment">//3. 保存到Request域中</span></span><br><span class="line">	req.setAttribute(<span class="string">&quot;book&quot;</span>, book);</span><br><span class="line">	<span class="comment">//4. 请求转发</span></span><br><span class="line">	req.getRequestDispatcher(<span class="string">&quot;/pages/manager/book_edit.jsp&quot;</span>).forward(req, resp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改book_edit.jsp中显示的数据：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;td&gt;&lt;input name=&quot;name&quot; type=&quot;text&quot; value=&quot;$&#123;requestScope.book.name&#125;&quot;/&gt;&lt;/td&gt;</span><br><span class="line">&lt;td&gt;&lt;input name=&quot;price&quot; type=&quot;text&quot; value=&quot;$&#123;requestScope.book.price&#125;&quot;/&gt;&lt;/td&gt;</span><br><span class="line">&lt;td&gt;&lt;input name=&quot;author&quot; type=&quot;text&quot; value=&quot;$&#123;requestScope.book.author&#125;&quot;/&gt;&lt;/td&gt;</span><br><span class="line">&lt;td&gt;&lt;input name=&quot;sales&quot; type=&quot;text&quot; value=&quot;$&#123;requestScope.book.sales&#125;&quot;/&gt;&lt;/td&gt;</span><br><span class="line">&lt;td&gt;&lt;input name=&quot;stock&quot; type=&quot;text&quot; value=&quot;$&#123;requestScope.book.stock&#125;&quot;/&gt;&lt;/td&gt;</span><br></pre></td></tr></table></figure>

<p>在BookServlet中添加update方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">	<span class="comment">//1. 获取请求的参数，封装成Book对象</span></span><br><span class="line">	Book book = WebUtils.copyParamToBean(req.getParameterMap(), <span class="keyword">new</span> Book());</span><br><span class="line">	<span class="comment">//2. 修改图书</span></span><br><span class="line">	bookService.updateBook(book);</span><br><span class="line">	<span class="comment">//3. 重定向</span></span><br><span class="line">	resp.sendRedirect(req.getContextPath() + <span class="string">&quot;/manager/bookServlet?action=list&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改book_edit.jsp页面：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;action&quot;</span> value=<span class="string">&quot;$&#123;empty param.id ? &quot;</span>add<span class="string">&quot; : &quot;</span>update<span class="string">&quot;&#125;&quot;</span>/&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;id&quot;</span> value=<span class="string">&quot;$&#123;requestScope.book.id&#125;&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>



<h3 id="五-图书分页"><a href="#五-图书分页" class="headerlink" title="五. 图书分页"></a>五. 图书分页</h3><p>分页模型Page：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Page</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer PAGE_SIZE = <span class="number">4</span>;      <span class="comment">//默认每页显示四条记录</span></span><br><span class="line">    <span class="keyword">private</span> Integer pageNo;     <span class="comment">//当前页码</span></span><br><span class="line">    <span class="keyword">private</span> Integer pageTotal;      <span class="comment">//总页码</span></span><br><span class="line">    <span class="keyword">private</span> Integer pageSize = PAGE_SIZE;       <span class="comment">//每页显示几条</span></span><br><span class="line">    <span class="keyword">private</span> Integer pageTotalCount;     <span class="comment">//总记录数</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; items;      <span class="comment">//当前页数据</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BookDaoImpl代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Integer <span class="title">queryForPageTotalCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	String sql = <span class="string">&quot;select count(*) from t_book&quot;</span>;</span><br><span class="line">	Number count = (Number) queryForSingleValue(sql);</span><br><span class="line">	<span class="keyword">return</span> count.intValue();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Book&gt; <span class="title">queryForPageItems</span><span class="params">(<span class="keyword">int</span> begin, <span class="keyword">int</span> pageSize)</span> </span>&#123;</span><br><span class="line">	String sql = <span class="string">&quot;select `id` , `name` , `author` , `price` , `sales` , `stock` , `img_path` imgPath from t_book limit ?,?&quot;</span>;</span><br><span class="line">	<span class="keyword">return</span> queryForList(Book.class,sql,begin,pageSize);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BookServiceImpl代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Page&lt;Book&gt; <span class="title">page</span><span class="params">(<span class="keyword">int</span> pageNo, <span class="keyword">int</span> pageSize)</span> </span>&#123;</span><br><span class="line">	Page&lt;Book&gt; page = <span class="keyword">new</span> Page&lt;&gt;();</span><br><span class="line">	page.setPageNo(pageNo);     <span class="comment">//设置当前页码</span></span><br><span class="line">	page.setPageSize(pageSize);     <span class="comment">//设置每页显示的数量</span></span><br><span class="line">	Integer pageTotalCount = bookDao.queryForPageTotalCount();      <span class="comment">//总记录数</span></span><br><span class="line">	page.setPageTotalCount(pageTotalCount);     <span class="comment">//设置总记录数</span></span><br><span class="line">	Integer pageTotal = pageTotalCount / pageSize;</span><br><span class="line">	<span class="keyword">if</span> (pageTotalCount % pageSize &gt; <span class="number">0</span>)&#123;</span><br><span class="line">		pageTotal ++;</span><br><span class="line">	&#125;</span><br><span class="line">	page.setPageTotal(pageTotal);</span><br><span class="line">	<span class="keyword">int</span> begin = (page.getPageNo() - <span class="number">1</span>) * pageSize;      <span class="comment">//求当前页的开始索引</span></span><br><span class="line">	List&lt;Book&gt; items = bookDao.queryForPageItems(begin,pageSize);</span><br><span class="line">	page.setItems(items);       <span class="comment">//设置当前页数据</span></span><br><span class="line">	<span class="keyword">return</span> page;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BookServlet程序代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">page</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">	<span class="comment">//1. 获取请求参数</span></span><br><span class="line">	<span class="keyword">int</span> pageNo = WebUtils.parseInt(req.getParameter(<span class="string">&quot;pageNo&quot;</span>), <span class="number">1</span>);</span><br><span class="line">	<span class="keyword">int</span> pageSize = WebUtils.parseInt(req.getParameter(<span class="string">&quot;pageSize&quot;</span>), Page.PAGE_SIZE);</span><br><span class="line">	<span class="comment">//2. 获取page对象</span></span><br><span class="line">	Page&lt;Book&gt; page = bookService.page(pageNo, pageSize);</span><br><span class="line">	<span class="comment">//3. 保存Page对象到Request域中</span></span><br><span class="line">	req.setAttribute(<span class="string">&quot;page&quot;</span>, page);</span><br><span class="line">	<span class="comment">//4. 请求转发</span></span><br><span class="line">	req.getRequestDispatcher(<span class="string">&quot;/pages/manager/book_manager.jsp&quot;</span>).forward(req, resp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改manager_main.jsp中的地址：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=&quot;manager/bookServlet?action=page&quot;&gt;图书管理&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p>修改book_manager.jsp：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:forEach items=<span class="string">&quot;$&#123;requestScope.page.items&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;book&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;div id=<span class="string">&quot;page_nav&quot;</span>&gt;</span><br><span class="line">	&lt;%--当前页码大于首页才显示--%&gt;</span><br><span class="line">	&lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;requestScope.page.pageNo &gt; 1&#125;&quot;</span>&gt;</span><br><span class="line">		&lt;a href=&quot;manager/bookServlet?action=page&amp;pageNo=1&quot;&gt;首页&lt;/a&gt;</span><br><span class="line">		&lt;a href=&quot;manager/bookServlet?action=page&amp;pageNo=$&#123;requestScope.page.pageNo-1&#125;&quot;&gt;上一页&lt;/a&gt;</span><br><span class="line">	&lt;/c:if&gt;</span><br><span class="line"></span><br><span class="line">	&lt;a href=&quot;#&quot;&gt;3&lt;/a&gt;</span><br><span class="line">	【$&#123;requestScope.page.pageNo&#125;】</span><br><span class="line">	&lt;a href=&quot;#&quot;&gt;5&lt;/a&gt;</span><br><span class="line">	&lt;%--当前页码小于总页数才显示--%&gt;</span><br><span class="line">	&lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;requestScope.page.pageNo &lt; requestScope.page.pageTotal&#125;&quot;</span>&gt;</span><br><span class="line">		&lt;a href=&quot;manager/bookServlet?action=page&amp;pageNo=$&#123;requestScope.page.pageNo+1&#125;&quot;&gt;下一页&lt;/a&gt;</span><br><span class="line">		&lt;a href=&quot;manager/bookServlet?action=page&amp;pageNo=$&#123;requestScope.page.pageTotal&#125;&quot;&gt;末页&lt;/a&gt;</span><br><span class="line">	&lt;/c:if&gt;</span><br><span class="line"></span><br><span class="line">	共$&#123;requestScope.page.pageTotal&#125;页，$&#123;requestScope.page.pageTotalCount&#125;条记录</span><br><span class="line">	到第&lt;input value=<span class="string">&quot;$&#123;requestScope.page.pageNo&#125;&quot;</span> name=<span class="string">&quot;pn&quot;</span> id=<span class="string">&quot;pn_input&quot;</span>/&gt;页</span><br><span class="line">	&lt;input id=<span class="string">&quot;searchPageBtn&quot;</span> type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;确定&quot;</span>&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">		$(function ()&#123;</span><br><span class="line">			<span class="comment">//绑定单击事件，跳转到指定页码</span></span><br><span class="line">			$(<span class="string">&quot;#searchPageBtn&quot;</span>).click(function () &#123;</span><br><span class="line">				<span class="keyword">var</span> pageNo = $(<span class="string">&quot;#pn_input&quot;</span>).val();</span><br><span class="line">				<span class="keyword">if</span> (pageNo &lt; <span class="number">1</span>) &#123;</span><br><span class="line">					alert(<span class="string">&quot;您输入的页码不合法，将为您显示第1页内容&quot;</span>);</span><br><span class="line">				&#125;</span><br><span class="line">                <span class="keyword">if</span> (pageNo &gt; $&#123;requestScope.page.pageTotal&#125;)&#123;</span><br><span class="line">                    alert(<span class="string">&quot;您输入的页码超出范围，将为您显示最后一页内容&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">				location.href = <span class="string">&quot;$&#123;pageScope.basePath&#125;manager/bookServlet?action=page&amp;pageNo=&quot;</span> + pageNo;</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;);</span><br><span class="line">	&lt;/script&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>修改Page对象的setPageNo方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPageNo</span><span class="params">(Integer pageNo)</span> </span>&#123;</span><br><span class="line">	<span class="comment">//数据边界有效性检查</span></span><br><span class="line">	<span class="keyword">if</span> (pageNo &lt; <span class="number">1</span>) &#123;</span><br><span class="line">		pageNo = <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (pageNo &gt; pageTotal) &#123;</span><br><span class="line">		pageNo = pageTotal;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">this</span>.pageNo = pageNo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改BookServiceImpl中的page方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">page.setPageTotal(pageTotal);       <span class="comment">//设置总页码</span></span><br><span class="line">page.setPageNo(pageNo);     <span class="comment">//设置当前页码（顺序在pageTotal后面）</span></span><br></pre></td></tr></table></figure>

<p>分页模块的页码显示：点击页码跳转</p>
<p>修改book_manager.jsp内容：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--页码输出开始（每次展示<span class="number">5</span>页）--%&gt;</span><br><span class="line">&lt;c:choose&gt;</span><br><span class="line">	&lt;%--总页码&lt;=<span class="number">5</span>时，页码范围是：<span class="number">1</span>~总页码--%&gt;</span><br><span class="line">	&lt;c:when test=<span class="string">&quot;$&#123;requestScope.page.pageTotal &lt;= 5&#125;&quot;</span>&gt;</span><br><span class="line">		&lt;c:set <span class="keyword">var</span>=<span class="string">&quot;begin&quot;</span> value=<span class="string">&quot;1&quot;</span>/&gt;</span><br><span class="line">		&lt;c:set <span class="keyword">var</span>=<span class="string">&quot;end&quot;</span> value=<span class="string">&quot;$&#123;requestScope.page.pageTotal&#125;&quot;</span>/&gt;</span><br><span class="line">	&lt;/c:when&gt;</span><br><span class="line">	&lt;%--总页码&gt;<span class="number">5</span>时--%&gt;</span><br><span class="line">	&lt;c:when test=<span class="string">&quot;$&#123;requestScope.page.pageTotal &gt; 5&#125;&quot;</span>&gt;</span><br><span class="line">		&lt;c:choose&gt;</span><br><span class="line">			&lt;%--当前页码为前三个时，页码范围：<span class="number">1</span>~<span class="number">5</span>--%&gt;</span><br><span class="line">			&lt;c:when test=<span class="string">&quot;$&#123;requestScope.page.pageNo &lt;= 3&#125;&quot;</span>&gt;</span><br><span class="line">				&lt;c:set <span class="keyword">var</span>=<span class="string">&quot;begin&quot;</span> value=<span class="string">&quot;1&quot;</span>/&gt;</span><br><span class="line">				&lt;c:set <span class="keyword">var</span>=<span class="string">&quot;end&quot;</span> value=<span class="string">&quot;5&quot;</span>/&gt;</span><br><span class="line">			&lt;/c:when&gt;</span><br><span class="line">			&lt;%--当前页码为最后三个时，页码范围：总页码-<span class="number">4</span>~总页码--%&gt;</span><br><span class="line">			&lt;c:when test=<span class="string">&quot;$&#123;requestScope.page.pageNo &gt; requestScope.page.pageTotal-3&#125;&quot;</span>&gt;</span><br><span class="line">				&lt;c:set <span class="keyword">var</span>=<span class="string">&quot;begin&quot;</span> value=<span class="string">&quot;$&#123;requestScope.page.pageTotal-4&#125;&quot;</span>/&gt;</span><br><span class="line">				&lt;c:set <span class="keyword">var</span>=<span class="string">&quot;end&quot;</span> value=<span class="string">&quot;$&#123;requestScope.page.pageTotal&#125;&quot;</span>/&gt;</span><br><span class="line">			&lt;/c:when&gt;</span><br><span class="line">			&lt;%--当前页码在中间时，页码范围：当前页码-<span class="number">2</span>~当前页码+<span class="number">2</span>--%&gt;</span><br><span class="line">			&lt;c:otherwise&gt;</span><br><span class="line">				&lt;c:set <span class="keyword">var</span>=<span class="string">&quot;begin&quot;</span> value=<span class="string">&quot;$&#123;requestScope.page.pageNo-2&#125;&quot;</span>/&gt;</span><br><span class="line">				&lt;c:set <span class="keyword">var</span>=<span class="string">&quot;end&quot;</span> value=<span class="string">&quot;$&#123;requestScope.page.pageNo+2&#125;&quot;</span>/&gt;</span><br><span class="line">			&lt;/c:otherwise&gt;</span><br><span class="line">		&lt;/c:choose&gt;</span><br><span class="line">	&lt;/c:when&gt;</span><br><span class="line">&lt;/c:choose&gt;</span><br><span class="line"></span><br><span class="line">&lt;c:forEach begin=<span class="string">&quot;$&#123;begin&#125;&quot;</span> end=<span class="string">&quot;$&#123;end&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;i&quot;</span>&gt;</span><br><span class="line">	&lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;i == requestScope.page.pageNo&#125;&quot;</span>&gt;</span><br><span class="line">		【$&#123;i&#125;】		&lt;%-- 当前页码不可点击 --%&gt;</span><br><span class="line">	&lt;/c:if&gt;</span><br><span class="line">	&lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;i != requestScope.page.pageNo&#125;&quot;</span>&gt;</span><br><span class="line">		&lt;a href=&quot;manager/bookServlet?action=page&amp;pageNo=$&#123;i&#125;&quot;&gt;$&#123;i&#125;&lt;/a&gt;</span><br><span class="line">	&lt;/c:if&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br><span class="line">&lt;%--页码数处结束--%&gt;</span><br></pre></td></tr></table></figure>

<p>设置分页后修改添加、删除、修改的回显页面：</p>
<p>在book_manager.jsp中请求地址后加上当前页码参数：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;td&gt;&lt;a href=&quot;pages/manager/book_edit.jsp?pageNo=$&#123;requestScope.page.pageTotal+1&#125;&quot;&gt;添加图书&lt;/a&gt;&lt;/td&gt;</span><br><span class="line"></span><br><span class="line">&lt;td&gt;&lt;a href=&quot;manager/bookServlet?action=getBook&amp;id=$&#123;book.id&#125;&amp;pageNo=$&#123;requestScope.page.pageNo&#125;&quot;&gt;修改&lt;/a&gt;&lt;/td&gt;</span><br><span class="line"></span><br><span class="line">&lt;td&gt;&lt;a class=&quot;deleteClass&quot; href=&quot;manager/bookServlet?action=delete&amp;id=$&#123;book.id&#125;&amp;pageNo=$&#123;requestScope.page.pageNo&#125;&quot;&gt;删除&lt;/a&gt;&lt;/td&gt;</span><br></pre></td></tr></table></figure>

<p>在book_edit.jsp页面中使用隐藏域记录pageNo参数：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;pageNo&quot;</span> value=<span class="string">&quot;$&#123;param.pageNo&#125;&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<p>修改BookServlet中添加、修改、删除方法的重定向地址：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">resp.sendRedirect(req.getContextPath() + <span class="string">&quot;/manager/bookServlet?action=page&amp;pageNo=&quot;</span> + req.getParameter(<span class="string">&quot;pageNo&quot;</span>));</span><br></pre></td></tr></table></figure>

<h4 id="首页index-jsp的跳转"><a href="#首页index-jsp的跳转" class="headerlink" title="首页index.jsp的跳转"></a>首页index.jsp的跳转</h4><p>在原index.jsp中设置跳转：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;jsp:forward page=&quot;/client/bookServlet?action=page&quot;&gt;&lt;/jsp:forward&gt;</span><br></pre></td></tr></table></figure>

<p>创建ClientBookServlet（复制BookServlet的page方法）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClientBookServlet</span> <span class="keyword">extends</span> <span class="title">BaseServlet</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> BookService bookService = <span class="keyword">new</span> BookServiceImpl();</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">page</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//1. 获取请求参数</span></span><br><span class="line">        <span class="keyword">int</span> pageNo = WebUtils.parseInt(req.getParameter(<span class="string">&quot;pageNo&quot;</span>), <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">int</span> pageSize = WebUtils.parseInt(req.getParameter(<span class="string">&quot;pageSize&quot;</span>), Page.PAGE_SIZE);</span><br><span class="line">        <span class="comment">//2. 获取page对象</span></span><br><span class="line">        Page&lt;Book&gt; page = bookService.page(pageNo, pageSize);</span><br><span class="line">        <span class="comment">//3. 保存Page对象到Request域中</span></span><br><span class="line">        req.setAttribute(<span class="string">&quot;page&quot;</span>, page);</span><br><span class="line">        <span class="comment">//4. 请求转发</span></span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;/pages/client/index.jsp&quot;</span>).forward(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>新建/pages/client/index.jsp（剪切原index.jsp内容，修改分页条跳转地址为client/bookServlet…）</p>
<h4 id="分页条的抽取"><a href="#分页条的抽取" class="headerlink" title="分页条的抽取"></a>分页条的抽取</h4><p>在page对象中添加url属性：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String url;     <span class="comment">//分页条的请求地址</span></span><br><span class="line"><span class="comment">//setter、getter，重新生成toString方法</span></span><br></pre></td></tr></table></figure>

<p>分别在BookServlet与ClientBookServlet中设置url：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">page.setUrl(<span class="string">&quot;manager/bookServlet?action=page&quot;</span>);</span><br><span class="line"></span><br><span class="line">page.setUrl(<span class="string">&quot;client/bookServlet?action=page&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>将分页条请求地址都改为${requestScope.page.url}，抽取出page_nav.jsp</p>
<p>静态包含：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">&quot;/pages/common/page_nav.jsp&quot;</span>%&gt;</span><br></pre></td></tr></table></figure>

<h4 id="价格搜索模块"><a href="#价格搜索模块" class="headerlink" title="价格搜索模块"></a>价格搜索模块</h4><p>index.jsp中设置跳转地址与隐藏域：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">&quot;client/bookServlet&quot;</span> method=<span class="string">&quot;get&quot;</span>&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;action&quot;</span> value=<span class="string">&quot;pageByPrice&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<p>ClientBookService中添加方法pageByPrice：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">pageByPrice</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">	<span class="comment">//1. 获取请求参数</span></span><br><span class="line">	<span class="keyword">int</span> pageNo = WebUtils.parseInt(req.getParameter(<span class="string">&quot;pageNo&quot;</span>), <span class="number">1</span>);</span><br><span class="line">	<span class="keyword">int</span> pageSize = WebUtils.parseInt(req.getParameter(<span class="string">&quot;pageSize&quot;</span>), Page.PAGE_SIZE);</span><br><span class="line">	<span class="keyword">int</span> min = WebUtils.parseInt(req.getParameter(<span class="string">&quot;min&quot;</span>),<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">int</span> max = WebUtils.parseInt(req.getParameter(<span class="string">&quot;max&quot;</span>),Integer.MAX_VALUE);</span><br><span class="line">	<span class="comment">//2. 获取page对象</span></span><br><span class="line">    <span class="comment">//在BookService接口中补充方法pageByPrice</span></span><br><span class="line">	Page&lt;Book&gt; page = bookService.pageByPrice(pageNo, pageSize, min, max);</span><br><span class="line">	page.setUrl(<span class="string">&quot;client/bookServlet?action=pageByPrice&quot;</span>);</span><br><span class="line">	<span class="comment">//3. 保存Page对象到Request域中</span></span><br><span class="line">	req.setAttribute(<span class="string">&quot;page&quot;</span>, page);</span><br><span class="line">	<span class="comment">//4. 请求转发</span></span><br><span class="line">	req.getRequestDispatcher(<span class="string">&quot;/pages/client/index.jsp&quot;</span>).forward(req, resp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BookServiceImpl中添加方法pageByPrice：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Page&lt;Book&gt; <span class="title">pageByPrice</span><span class="params">(<span class="keyword">int</span> pageNo, <span class="keyword">int</span> pageSize, <span class="keyword">int</span> min, <span class="keyword">int</span> max)</span> </span>&#123;</span><br><span class="line">	Page&lt;Book&gt; page = <span class="keyword">new</span> Page&lt;&gt;();</span><br><span class="line"></span><br><span class="line">	page.setPageSize(pageSize);     <span class="comment">//设置每页显示的数量</span></span><br><span class="line">    <span class="comment">//在BookDao接口中生成相应方法</span></span><br><span class="line">	Integer pageTotalCount = bookDao.queryForPageTotalCountByPrice(min,max);</span><br><span class="line">	page.setPageTotalCount(pageTotalCount);     <span class="comment">//设置总记录数</span></span><br><span class="line">	Integer pageTotal = pageTotalCount / pageSize;</span><br><span class="line">	<span class="keyword">if</span> (pageTotalCount % pageSize &gt; <span class="number">0</span>)&#123;</span><br><span class="line">		pageTotal ++;</span><br><span class="line">	&#125;</span><br><span class="line">	page.setPageTotal(pageTotal);       <span class="comment">//设置总页码</span></span><br><span class="line">	page.setPageNo(pageNo);     <span class="comment">//设置当前页码</span></span><br><span class="line">	<span class="keyword">int</span> begin = (page.getPageNo() - <span class="number">1</span>) * pageSize;      <span class="comment">//求当前页的开始索引</span></span><br><span class="line">    <span class="comment">////在BookDao接口中生成相应方法</span></span><br><span class="line">	List&lt;Book&gt; items = bookDao.queryForPageItemsByPrice(begin,pageSize,min,max);</span><br><span class="line">	page.setItems(items);       <span class="comment">//设置当前页数据</span></span><br><span class="line">	<span class="keyword">return</span> page;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在BookDaoImpl中重写方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Integer <span class="title">queryForPageTotalCountByPrice</span><span class="params">(<span class="keyword">int</span> min, <span class="keyword">int</span> max)</span> </span>&#123;</span><br><span class="line">	String sql = <span class="string">&quot;select count(*) from t_book where price between ? and ?&quot;</span>;</span><br><span class="line">	Number count = (Number) queryForSingleValue(sql, min, max);</span><br><span class="line">	<span class="keyword">return</span> count.intValue();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Book&gt; <span class="title">queryForPageItemsByPrice</span><span class="params">(<span class="keyword">int</span> begin, <span class="keyword">int</span> pageSize, <span class="keyword">int</span> min, <span class="keyword">int</span> max)</span> </span>&#123;</span><br><span class="line">	String sql = <span class="string">&quot;select `id`,`name`,`author`,`price`,`sales`,`stock`,`img_path` imgPath from t_book where price between ? and ? order by price limit ?,?&quot;</span>;</span><br><span class="line">	<span class="keyword">return</span> queryForList(Book.class,sql,min,max,begin,pageSize);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>设置搜索价格区间回显：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">价格：&lt;input id=<span class="string">&quot;min&quot;</span> type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;min&quot;</span> value=<span class="string">&quot;$&#123;param.min&#125;&quot;</span>&gt; 元 -</span><br><span class="line">&lt;input id=<span class="string">&quot;max&quot;</span> type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;max&quot;</span> value=<span class="string">&quot;$&#123;param.max&#125;&quot;</span>&gt; 元</span><br></pre></td></tr></table></figure>

<p>解决分页条不带价格区间的问题：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//修改ClientBookServlet的pageByPrice方法：</span></span><br><span class="line">StringBuilder sb = <span class="keyword">new</span> StringBuilder(<span class="string">&quot;client/bookServlet?action=pageByPrice&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (req.getParameter(<span class="string">&quot;min&quot;</span>) != <span class="keyword">null</span>)&#123;</span><br><span class="line">	sb.append(<span class="string">&quot;&amp;min=&quot;</span> + req.getParameter(<span class="string">&quot;min&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (req.getParameter(<span class="string">&quot;max&quot;</span>) != <span class="keyword">null</span>)&#123;</span><br><span class="line">	sb.append(<span class="string">&quot;&amp;max=&quot;</span> + req.getParameter(<span class="string">&quot;max&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line">page.setUrl(sb.toString());</span><br></pre></td></tr></table></figure>



<h3 id="六-用户登陆、注销、验证码"><a href="#六-用户登陆、注销、验证码" class="headerlink" title="六. 用户登陆、注销、验证码"></a>六. 用户登陆、注销、验证码</h3><h4 id="登录后显示用户名功能实现"><a href="#登录后显示用户名功能实现" class="headerlink" title="登录后显示用户名功能实现"></a>登录后显示用户名功能实现</h4><p>UserServlet中保存登录信息：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//登陆成功，保存用户信息到Session域中</span></span><br><span class="line">req.getSession().setAttribute(<span class="string">&quot;user&quot;</span>, loginUser);</span><br></pre></td></tr></table></figure>

<p>修改login_succuess_menu.jsp：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;span&gt;欢迎&lt;span class=&quot;um_span&quot;&gt;$&#123;sessionScope.user.username&#125;&lt;/span&gt;光临尚硅谷书城&lt;/span&gt;</span><br></pre></td></tr></table></figure>

<p>修改index.jsp：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">	&lt;%--如果用户未登录，显示登陆和注册--%&gt;</span><br><span class="line">	&lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;empty sessionScope.user&#125;&quot;</span>&gt;</span><br><span class="line">		&lt;a href=&quot;pages/user/login.jsp&quot;&gt;登录&lt;/a&gt; |</span><br><span class="line">		&lt;a href=&quot;pages/user/regist.jsp&quot;&gt;注册&lt;/a&gt; &amp;nbsp;&amp;nbsp;</span><br><span class="line">	&lt;/c:if&gt;</span><br><span class="line"></span><br><span class="line">	&lt;%--如果用户已登录，显示用户信息--%&gt;</span><br><span class="line">	&lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;not empty sessionScope.user&#125;&quot;</span>&gt;</span><br><span class="line">		&lt;span&gt;欢迎&lt;span class=&quot;um_span&quot;&gt;$&#123;sessionScope.user.username&#125;&lt;/span&gt;光临尚硅谷书城&lt;/span&gt;</span><br><span class="line">		&lt;a href=&quot;pages/order/order.jsp&quot;&gt;我的订单&lt;/a&gt;</span><br><span class="line">		&lt;a href=&quot;index.jsp&quot;&gt;注销&lt;/a&gt;&amp;nbsp;&amp;nbsp;</span><br><span class="line">	&lt;/c:if&gt;</span><br><span class="line"></span><br><span class="line">	&lt;a href=&quot;pages/cart/cart.jsp&quot;&gt;购物车&lt;/a&gt;</span><br><span class="line">	&lt;a href=&quot;pages/manager/manager.jsp&quot;&gt;后台管理&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h4 id="注销功能实现"><a href="#注销功能实现" class="headerlink" title="注销功能实现"></a>注销功能实现</h4><p>UserServlet中添加logout方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">logout</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">	<span class="comment">//销毁Session中用户登录信息（或销毁Session）</span></span><br><span class="line">	req.getSession().invalidate();</span><br><span class="line">	<span class="comment">//重定向到首页</span></span><br><span class="line">	resp.sendRedirect(req.getContextPath());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改index.jsp和login_success_menu.jsp的注销链接：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=&quot;userServlet?action=logout&quot;&gt;注销&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<h4 id="验证码解决表单重复提交"><a href="#验证码解决表单重复提交" class="headerlink" title="验证码解决表单重复提交"></a>验证码解决表单重复提交</h4><p>使用谷歌kaptcha图片验证码：</p>
<ol>
<li>导入jar包：kaptcha-2.3.2.jar</li>
<li>在web.xml中配置验证码的Servlet地址</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>KaptchaServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.google.code.kaptcha.servlet.KaptchaServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>KaptchaServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/kaptcha.jpg<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在regist.jsp中添加img标签使用验证码</li>
</ol>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;label&gt;验证码：&lt;/label&gt;</span><br><span class="line">&lt;input <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;itxt&quot;</span> type=<span class="string">&quot;text&quot;</span> style=<span class="string">&quot;width: 110px;&quot;</span> name=<span class="string">&quot;code&quot;</span> id=<span class="string">&quot;code&quot;</span>/&gt;</span><br><span class="line">&lt;img id=<span class="string">&quot;code_img&quot;</span> alt=<span class="string">&quot;&quot;</span> src=<span class="string">&quot;kaptcha.jpg&quot;</span> style=<span class="string">&quot;float: right; margin-right: 40px; width: 110px; height: 40px&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>修改UserServlet的regist方法</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取session中的验证码</span></span><br><span class="line">String token = (String) req.getSession().getAttribute(KAPTCHA_SESSION_KEY);</span><br><span class="line"><span class="comment">//删除session中的验证码</span></span><br><span class="line">req.getSession().removeAttribute(KAPTCHA_SESSION_KEY);</span><br><span class="line"></span><br><span class="line"><span class="comment">//2. 检查验证码是否正确</span></span><br><span class="line"><span class="keyword">if</span> (token != <span class="keyword">null</span> &amp;&amp; token.equalsIgnoreCase(code)) &#123;      <span class="comment">//忽略大小写</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>设置点击图片更换验证码</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//验证码图片的单击事件</span></span><br><span class="line">$(<span class="string">&quot;#code_img&quot;</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="comment">//后面加参数为了避免直接读取浏览器缓存</span></span><br><span class="line">	<span class="built_in">this</span>.src = <span class="string">&quot;$&#123;basePath&#125;kaptcha.jpg?date=&quot;</span> + <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="七-购物车"><a href="#七-购物车" class="headerlink" title="七. 购物车"></a>七. 购物车</h3><p>购物车实现方案：</p>
<ol>
<li>把购物车信息保存到Session域中（本项目使用）</li>
<li>保存到数据库中</li>
<li>使用Cookie+Redis缓存+数据库</li>
</ol>
<p>pojo下创建CartItem购物车商品项：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CartItem</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer count;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal totalPrice;</span><br><span class="line">    <span class="comment">//有参无参构造、toString、setter、getter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>pojo下创建Cart购物车对象：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cart</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*private Integer totalCount;</span></span><br><span class="line"><span class="comment">    private BigDecimal totalPrice;*/</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;Integer, CartItem&gt; items = <span class="keyword">new</span> LinkedHashMap&lt;Integer, CartItem&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加商品项</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addItem</span><span class="params">(CartItem cartItem)</span></span>&#123;</span><br><span class="line">        <span class="comment">//先查询购物车是否已添加该商品</span></span><br><span class="line">        CartItem item = items.get(cartItem.getId());</span><br><span class="line">        <span class="keyword">if</span> (item == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="comment">//没有添加过，直接放到集合中</span></span><br><span class="line">            items.put(cartItem.getId(), cartItem);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//添加过，数量、金额累加</span></span><br><span class="line">            item.setCount(item.getCount() + <span class="number">1</span>);</span><br><span class="line">            item.setTotalPrice(item.getPrice().multiply(<span class="keyword">new</span> BigDecimal(item.getCount())));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除商品项</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteItem</span><span class="params">(Integer id)</span></span>&#123;</span><br><span class="line">        items.remove(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//清空购物车</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span>&#123;</span><br><span class="line">        items.clear();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//修改商品数量</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateCount</span><span class="params">(Integer id, Integer count)</span></span>&#123;</span><br><span class="line">        <span class="comment">//先查询购物车是否有此商品</span></span><br><span class="line">        CartItem cartItem = items.get(id);</span><br><span class="line">        <span class="keyword">if</span> (cartItem != <span class="keyword">null</span>)&#123;</span><br><span class="line">            cartItem.setCount(count);</span><br><span class="line">            cartItem.setTotalPrice(cartItem.getPrice().multiply(<span class="keyword">new</span> BigDecimal(cartItem.getCount())));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getTotalCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Integer totalCount = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;Integer, CartItem&gt; entry : items.entrySet()) &#123;</span><br><span class="line">            totalCount += entry.getValue().getCount();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> totalCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BigDecimal <span class="title">getTotalPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        BigDecimal totalPrice = <span class="keyword">new</span> BigDecimal(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;Integer, CartItem&gt; entry : items.entrySet()) &#123;</span><br><span class="line">            totalPrice = totalPrice.add(entry.getValue().getTotalPrice());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> totalPrice;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;Integer, CartItem&gt; <span class="title">getItems</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> items;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setItems</span><span class="params">(Map&lt;Integer, CartItem&gt; items)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.items = items;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Cart&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;totalCount=&quot;</span> + getTotalCount() +</span><br><span class="line">                <span class="string">&quot;, totalPrice=&quot;</span> + getTotalPrice() +</span><br><span class="line">                <span class="string">&quot;, items=&quot;</span> + items +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="加入购物车功能实现"><a href="#加入购物车功能实现" class="headerlink" title="加入购物车功能实现"></a>加入购物车功能实现</h4><p>编写CartServlet：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CartServlet</span> <span class="keyword">extends</span> <span class="title">BaseServlet</span></span>&#123;</span><br><span class="line">    BookService bookService = <span class="keyword">new</span> BookServiceImpl();</span><br><span class="line">    <span class="comment">//加入购物车</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">addItem</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//获取商品编号</span></span><br><span class="line">        <span class="keyword">int</span> id = WebUtils.parseInt(req.getParameter(<span class="string">&quot;id&quot;</span>), <span class="number">0</span>);</span><br><span class="line">        <span class="comment">//获取图书对象</span></span><br><span class="line">        Book book = bookService.queryBookById(id);</span><br><span class="line">        <span class="comment">//转化为CartItem对象</span></span><br><span class="line">        CartItem cartItem = <span class="keyword">new</span> CartItem(book.getId(), book.getName(), <span class="number">1</span>, book.getPrice(), book.getPrice());</span><br><span class="line">        <span class="comment">//判断购物车对象是否已创建，未创建则新建，已创建则添加</span></span><br><span class="line">        Cart cart = (Cart) req.getSession().getAttribute(<span class="string">&quot;cart&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (cart == <span class="keyword">null</span>) &#123;</span><br><span class="line">            cart = <span class="keyword">new</span> Cart();</span><br><span class="line">            req.getSession().setAttribute(<span class="string">&quot;cart&quot;</span>, cart);</span><br><span class="line">        &#125;</span><br><span class="line">        cart.addItem(cartItem);</span><br><span class="line">        <span class="comment">//重定向回原商品所在页面</span></span><br><span class="line">        <span class="comment">//Http协议中请求头Referer会在发起请求时将地址发送给服务器</span></span><br><span class="line">        resp.sendRedirect(req.getHeader(<span class="string">&quot;Referer&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改index.jsp：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">	$(function ()&#123;		<span class="comment">//给加入购物车按钮绑定单击事件</span></span><br><span class="line">		$(<span class="string">&quot;button.addToCart&quot;</span>).click(function () &#123;</span><br><span class="line">			<span class="keyword">var</span> bookId = $(<span class="keyword">this</span>).attr(<span class="string">&quot;bookId&quot;</span>);</span><br><span class="line">			location.href = <span class="string">&quot;cartServlet?action=addItem&amp;id=&quot;</span> + bookId;</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;button bookId=&quot;$&#123;book.id&#125;&quot; class=&quot;addToCart&quot;&gt;加入购物车&lt;/button&gt;</span><br></pre></td></tr></table></figure>

<h4 id="购物车商品展示"><a href="#购物车商品展示" class="headerlink" title="购物车商品展示"></a>购物车商品展示</h4><p>修改cart.jsp：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--如果购物车为空--%&gt;</span><br><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;empty sessionScope.cart.items&#125;&quot;</span>&gt;</span><br><span class="line">	&lt;tr&gt;</span><br><span class="line">		&lt;td colspan=&quot;5&quot;&gt;&lt;a href=&quot;index.jsp&quot;&gt;当前购物车为空，返回首页&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">	&lt;/tr&gt;</span><br><span class="line">&lt;/c:if&gt;</span><br><span class="line">&lt;%--如果购物车非空--%&gt;</span><br><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;not empty sessionScope.cart.items&#125;&quot;</span>&gt;</span><br><span class="line">	&lt;c:forEach items=<span class="string">&quot;$&#123;sessionScope.cart.items&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;entry&quot;</span>&gt;</span><br><span class="line">		&lt;tr&gt;</span><br><span class="line">			&lt;td&gt;$&#123;entry.value.name&#125;&lt;/td&gt;</span><br><span class="line">			&lt;td&gt;$&#123;entry.value.count&#125;&lt;/td&gt;</span><br><span class="line">			&lt;td&gt;$&#123;entry.value.price&#125;&lt;/td&gt;</span><br><span class="line">			&lt;td&gt;$&#123;entry.value.totalPrice&#125;&lt;/td&gt;</span><br><span class="line">			&lt;td&gt;&lt;a href=&quot;#&quot;&gt;删除&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">		&lt;/tr&gt;</span><br><span class="line">	&lt;/c:forEach&gt;</span><br><span class="line">&lt;/c:if&gt;</span><br><span class="line"></span><br><span class="line">&lt;%--如果购物车非空，显示结账等信息--%&gt;</span><br><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;not empty sessionScope.cart.items&#125;&quot;</span>&gt;</span><br><span class="line">	&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;cart_info&quot;</span>&gt;</span><br><span class="line">		&lt;span class=&quot;cart_span&quot;&gt;购物车中共有&lt;span class=&quot;b_count&quot;&gt;$&#123;sessionScope.cart.totalCount&#125;&lt;/span&gt;件商品&lt;/span&gt;</span><br><span class="line">		&lt;span class=&quot;cart_span&quot;&gt;总金额&lt;span class=&quot;b_price&quot;&gt;$&#123;sessionScope.cart.totalPrice&#125;&lt;/span&gt;元&lt;/span&gt;</span><br><span class="line">		&lt;span class=&quot;cart_span&quot;&gt;&lt;a href=&quot;#&quot;&gt;清空购物车&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">		&lt;span class=&quot;cart_span&quot;&gt;&lt;a href=&quot;pages/cart/checkout.jsp&quot;&gt;去结账&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/c:if&gt;</span><br></pre></td></tr></table></figure>

<h4 id="删除购物车商品项"><a href="#删除购物车商品项" class="headerlink" title="删除购物车商品项"></a>删除购物车商品项</h4><p>CartServlet中添加deleteItem方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除商品项</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">deleteItem</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">	<span class="comment">//获取商品编号</span></span><br><span class="line">	<span class="keyword">int</span> id = WebUtils.parseInt(req.getParameter(<span class="string">&quot;id&quot;</span>), <span class="number">0</span>);</span><br><span class="line">	<span class="comment">//获取购物车对象</span></span><br><span class="line">	Cart cart = (Cart) req.getSession().getAttribute(<span class="string">&quot;cart&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span> (cart != <span class="keyword">null</span>) &#123;</span><br><span class="line">		cart.deleteItem(id);</span><br><span class="line">		resp.sendRedirect(req.getHeader(<span class="string">&quot;Referer&quot;</span>));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改cart.jsp：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">	$(function () &#123;</span><br><span class="line">		$(<span class="string">&quot;a.deleteItem&quot;</span>).click(function () &#123;</span><br><span class="line">			<span class="keyword">return</span> confirm(<span class="string">&quot;确定要删除【&quot;</span> + $(<span class="keyword">this</span>).parent().parent().find(<span class="string">&quot;td:first&quot;</span>).text() + <span class="string">&quot;】吗？&quot;</span>)</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;td&gt;&lt;a class=&quot;deleteItem&quot; href=&quot;cartServlet?action=deleteItem&amp;id=$&#123;entry.value.id&#125;&quot;&gt;删除&lt;/a&gt;&lt;/td&gt;</span><br></pre></td></tr></table></figure>

<h4 id="清空购物车"><a href="#清空购物车" class="headerlink" title="清空购物车"></a>清空购物车</h4><p>CartServlet中添加clear方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//清空购物车</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">	<span class="comment">//获得购物车对象</span></span><br><span class="line">	Cart cart = (Cart) req.getSession().getAttribute(<span class="string">&quot;cart&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span> (cart != <span class="keyword">null</span>)&#123;</span><br><span class="line">		cart.clear();</span><br><span class="line">		resp.sendRedirect(req.getHeader(<span class="string">&quot;Referer&quot;</span>));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改cart.jsp：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//给清空购物车绑定单击事件</span></span><br><span class="line">$(<span class="string">&quot;#clearCart&quot;</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> confirm(<span class="string">&quot;确定要清空购物车吗？&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;cart_span&quot;</span>&gt;<span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">&quot;clearCart&quot;</span> <span class="attr">href</span>=<span class="string">&quot;cartServlet?action=clear&quot;</span>&gt;</span>清空购物车<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span>&lt;/span&gt;</span><br></pre></td></tr></table></figure>

<h4 id="修改购物车商品数量"><a href="#修改购物车商品数量" class="headerlink" title="修改购物车商品数量"></a>修改购物车商品数量</h4><p>修改cart.jsp：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//给输入框绑定onchange内容发生改变事件</span></span><br><span class="line">$(<span class="string">&quot;.updateCount&quot;</span>).change(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="comment">//获取商品信息</span></span><br><span class="line">	<span class="keyword">var</span> name = $(<span class="built_in">this</span>).parent().parent().find(<span class="string">&quot;td:first&quot;</span>).text();</span><br><span class="line">	<span class="keyword">var</span> id = $(<span class="built_in">this</span>).attr(<span class="string">&quot;bookId&quot;</span>);</span><br><span class="line">	<span class="keyword">var</span> count = <span class="built_in">this</span>.value;</span><br><span class="line">	<span class="keyword">if</span> (confirm(<span class="string">&quot;确定将【&quot;</span> + name +<span class="string">&quot;】商品数量修改为&quot;</span> + count +<span class="string">&quot;吗？&quot;</span>))&#123;</span><br><span class="line">		location.href = <span class="string">&quot;cartServlet?action=updateCount&amp;count=&quot;</span> + count + <span class="string">&quot;&amp;id=&quot;</span> + id;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">//defaultValue属性是表单项Dom对象的默认value值</span></span><br><span class="line">		<span class="built_in">this</span>.value = <span class="built_in">this</span>.defaultValue;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&lt;td&gt;</span><br><span class="line">&lt;input <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;updateCount&quot;</span> bookId=<span class="string">&quot;$&#123;entry.value.id&#125;&quot;</span></span><br><span class="line">       style=<span class="string">&quot;width: 80px&quot;</span> type=<span class="string">&quot;text&quot;</span> value=<span class="string">&quot;$&#123;entry.value.count&#125;&quot;</span>&gt;</span><br><span class="line">&lt;/td&gt;</span><br></pre></td></tr></table></figure>

<p>CartServlet中添加updateCount方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//修改商品数量</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">updateCount</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">	<span class="comment">//获取请求的商品id、数量</span></span><br><span class="line">	<span class="keyword">int</span> id = WebUtils.parseInt(req.getParameter(<span class="string">&quot;id&quot;</span>), <span class="number">0</span>);</span><br><span class="line">	<span class="keyword">int</span> count = WebUtils.parseInt(req.getParameter(<span class="string">&quot;count&quot;</span>), <span class="number">1</span>);</span><br><span class="line">	Cart cart = (Cart) req.getSession().getAttribute(<span class="string">&quot;cart&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span> (cart != <span class="keyword">null</span>)&#123;</span><br><span class="line">		cart.updateCount(id, count);</span><br><span class="line">		resp.sendRedirect(req.getHeader(<span class="string">&quot;Referer&quot;</span>));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="首页购物车数据回显"><a href="#首页购物车数据回显" class="headerlink" title="首页购物车数据回显"></a>首页购物车数据回显</h4><p>CartServlet的addItem方法中保存最后添加商品的名称：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//保存最后添加的商品名称</span></span><br><span class="line">req.getSession().setAttribute(<span class="string">&quot;lastName&quot;</span>, cartItem.getName());</span><br></pre></td></tr></table></figure>

<p>在index.jsp显示信息：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;empty sessionScope.cart.items&#125;&quot;</span>&gt;</span><br><span class="line">	&lt;%--购物车为空--%&gt;</span><br><span class="line">	&lt;div&gt;&lt;span style=&quot;color: red&quot;&gt;当前购物车为空&lt;/span&gt;&lt;/div&gt;</span><br><span class="line">	&lt;br&gt;</span><br><span class="line">&lt;/c:if&gt;</span><br><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;not empty sessionScope.cart.items&#125;&quot;</span>&gt;</span><br><span class="line">	&lt;%--购物车不为空--%&gt;</span><br><span class="line">	&lt;span&gt;您的购物车中有$&#123;sessionScope.cart.totalCount&#125;件商品&lt;/span&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">		您刚刚将&lt;span style=&quot;color: red&quot;&gt;$&#123;sessionScope.lastName&#125;&lt;/span&gt;加入到了购物车中</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/c:if&gt;</span><br></pre></td></tr></table></figure>



<h3 id="八-订单"><a href="#八-订单" class="headerlink" title="八. 订单"></a>八. 订单</h3><p>创建订单模块数据库表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_order(</span><br><span class="line">	<span class="string">`order_id`</span> <span class="built_in">varchar</span>(<span class="number">50</span>) primary <span class="keyword">key</span>,</span><br><span class="line">	<span class="string">`create_time`</span> datetime,</span><br><span class="line">	<span class="string">`price`</span> <span class="built_in">decimal</span>(<span class="number">11</span>,<span class="number">2</span>),</span><br><span class="line">	<span class="string">`status`</span> <span class="built_in">int</span>,</span><br><span class="line">	<span class="string">`user_id`</span> <span class="built_in">int</span>,</span><br><span class="line">	<span class="keyword">foreign</span> <span class="keyword">key</span>(<span class="string">`user_id`</span>) <span class="keyword">references</span> t_user(<span class="string">`id`</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_order_item(</span><br><span class="line">	<span class="string">`id`</span> <span class="built_in">int</span> primary <span class="keyword">key</span> auto_increment,</span><br><span class="line">	<span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">100</span>),</span><br><span class="line">	<span class="string">`count`</span> <span class="built_in">int</span>,</span><br><span class="line">	<span class="string">`price`</span> <span class="built_in">decimal</span>(<span class="number">11</span>,<span class="number">2</span>),</span><br><span class="line">	<span class="string">`total_price`</span> <span class="built_in">decimal</span>(<span class="number">11</span>,<span class="number">2</span>),</span><br><span class="line">	<span class="string">`order_id`</span> <span class="built_in">varchar</span>(<span class="number">50</span>),</span><br><span class="line">	<span class="keyword">foreign</span> <span class="keyword">key</span>(<span class="string">`order_id`</span>) <span class="keyword">references</span> t_order(<span class="string">`order_id`</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>创建订单模块的数据模型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//订单</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String orderId;</span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    <span class="comment">//0表示未发货，1已发货，2已签收</span></span><br><span class="line">    <span class="keyword">private</span> Integer status = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> Integer userId;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//订单项</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderItem</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer count;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal totalPrice;</span><br><span class="line">    <span class="keyword">private</span> String orderId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写订单模块Dao接口及实现类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderDao</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">saveOrder</span><span class="params">(Order order)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderDaoImpl</span> <span class="keyword">extends</span> <span class="title">BaseDao</span> <span class="keyword">implements</span> <span class="title">OrderDao</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">saveOrder</span><span class="params">(Order order)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;insert into t_order(`order_id`,`create_time`,`price`,`status`,`user_id`) values(?,?,?,?,?)&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> update(sql,order.getOrderId(),order.getCreateTime(),order.getPrice(),order.getStatus(),order.getUserId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderItemDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">saveOrderItem</span><span class="params">(OrderItem orderItem)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderItemDaoImpl</span> <span class="keyword">extends</span> <span class="title">BaseDao</span> <span class="keyword">implements</span> <span class="title">OrderItemDao</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">saveOrderItem</span><span class="params">(OrderItem orderItem)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;insert into t_order_item(`name`,`count`,`price`,`total_price`,`order_id`) values(?,?,?,?,?)&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> update(sql,orderItem.getName(),orderItem.getCount(),orderItem.getPrice(),orderItem.getTotalPrice(),orderItem.getOrderId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写OrderService及实现类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">createOrder</span><span class="params">(Cart cart, Integer userId)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderServiceImpl</span> <span class="keyword">implements</span> <span class="title">OrderService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> OrderDao orderDao = <span class="keyword">new</span> OrderDaoImpl();</span><br><span class="line">    <span class="keyword">private</span> OrderItemDao orderItemDao = <span class="keyword">new</span> OrderItemDaoImpl();</span><br><span class="line">    <span class="keyword">private</span> BookDao bookDao = <span class="keyword">new</span> BookDaoImpl();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">createOrder</span><span class="params">(Cart cart, Integer userId)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//生成订单号（唯一性）</span></span><br><span class="line">        String orderId = System.currentTimeMillis() + <span class="string">&quot;&quot;</span> + userId;</span><br><span class="line">        <span class="comment">//创建订单对象</span></span><br><span class="line">        Order order = <span class="keyword">new</span> Order(orderId,<span class="keyword">new</span> Date(),cart.getTotalPrice(),<span class="number">0</span>,userId);</span><br><span class="line">        <span class="comment">//保存订单</span></span><br><span class="line">        orderDao.saveOrder(order);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//遍历购物车商品，将商品项转化为订单项保存</span></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;Integer, CartItem&gt; entry : cart.getItems().entrySet())&#123;</span><br><span class="line">            CartItem cartItem = entry.getValue();</span><br><span class="line">            OrderItem orderItem = <span class="keyword">new</span> OrderItem(<span class="keyword">null</span>, cartItem.getName(), cartItem.getCount(), cartItem.getPrice(),cartItem.getTotalPrice(), orderId);</span><br><span class="line">            <span class="comment">//保存订单到数据库</span></span><br><span class="line">            orderItemDao.saveOrderItem(orderItem);</span><br><span class="line">            <span class="comment">//更新首页库存和销量显示</span></span><br><span class="line">            Book book = bookDao.queryBookById(cartItem.getId());</span><br><span class="line">            book.setSales(book.getSales() + cartItem.getCount());</span><br><span class="line">            book.setStock(book.getStock() - cartItem.getCount());</span><br><span class="line">            bookDao.updateBook(book);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//清空购物车</span></span><br><span class="line">        cart.clear();</span><br><span class="line">        <span class="keyword">return</span> orderId;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="生成订单"><a href="#生成订单" class="headerlink" title="生成订单"></a>生成订单</h4><p>编写OrderServlet类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderServlet</span> <span class="keyword">extends</span> <span class="title">BaseServlet</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> OrderService orderService = <span class="keyword">new</span> OrderServiceImpl();</span><br><span class="line">    <span class="comment">//生成订单</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">createOrder</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//获取购物车对象</span></span><br><span class="line">        Cart cart = (Cart) req.getSession().getAttribute(<span class="string">&quot;cart&quot;</span>);</span><br><span class="line">        <span class="comment">//获取userId</span></span><br><span class="line">        User loginUser = (User) req.getSession().getAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (loginUser == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="comment">//用户未登录不能结算</span></span><br><span class="line">            req.getRequestDispatcher(<span class="string">&quot;/pages/user/login.jsp&quot;</span>).forward(req, resp);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Integer userId = loginUser.getId();</span><br><span class="line">        String orderId = orderService.createOrder(cart, userId);</span><br><span class="line">        req.getSession().setAttribute(<span class="string">&quot;orderId&quot;</span>, orderId);</span><br><span class="line">        resp.sendRedirect(req.getContextPath() + <span class="string">&quot;/pages/cart/checkout.jsp&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改cart.jsp：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;span class=&quot;cart_span&quot;&gt;&lt;a href=&quot;orderServlet?action=createOrder&quot;&gt;去结账&lt;/a&gt;&lt;/span&gt;</span><br></pre></td></tr></table></figure>

<p>修改checkout.jsp：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;您的订单已结算，订单号为：$&#123;sessionScope.orderId&#125;&lt;/h1&gt;</span><br></pre></td></tr></table></figure>



<h3 id="九-后台权限管理"><a href="#九-后台权限管理" class="headerlink" title="九. 后台权限管理"></a>九. 后台权限管理</h3><p>使用Filter过滤器拦截/pages/manager/下的所有内容</p>
<p>创建ManagerFilter：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">	HttpServletRequest httpServletRequest = (HttpServletRequest) servletRequest;</span><br><span class="line">	Object user = httpServletRequest.getSession().getAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span> (user == <span class="keyword">null</span>)&#123;</span><br><span class="line">    	httpServletRequest.getRequestDispatcher(<span class="string">&quot;/pages/user/login.jsp&quot;</span>).forward(servletRequest, servletResponse);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>web.xml中的配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>ManagerFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>filter.ManagerFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>ManagerFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/pages/manager/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--设置拦截访问后台Servlet--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/manager/bookServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="使用Filter和ThreadLocal组合管理事务"><a href="#使用Filter和ThreadLocal组合管理事务" class="headerlink" title="使用Filter和ThreadLocal组合管理事务"></a>使用Filter和ThreadLocal组合管理事务</h4><p>确保所有Dao操作都在同一个Connection连接对象中完成</p>
<p>修改JdbcUtils：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcUtils</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DruidDataSource dataSource;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;Connection&gt; conns = <span class="keyword">new</span> ThreadLocal&lt;Connection&gt;();</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">            InputStream inputStream = JdbcUtils.class.getClassLoader().getResourceAsStream(<span class="string">&quot;jdbc.properties&quot;</span>);</span><br><span class="line">            properties.load(inputStream);</span><br><span class="line">            dataSource = (DruidDataSource) DruidDataSourceFactory.createDataSource(properties);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取数据库连接池中的连接，返回null表示连接失败</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Connection conn = conns.get();</span><br><span class="line">        <span class="keyword">if</span> (conn == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                conn = dataSource.getConnection();</span><br><span class="line">                <span class="comment">//保存到LocalThread对象中</span></span><br><span class="line">                conns.set(conn);</span><br><span class="line">                <span class="comment">//设置手动管理事务</span></span><br><span class="line">                conn.setAutoCommit(<span class="keyword">false</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> conn;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//提交事务并关闭连接</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">commitAndClose</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Connection conn = conns.get();</span><br><span class="line">        <span class="keyword">if</span> (conn != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="comment">//不为null表示之前使用过连接</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                conn.commit();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    conn.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//必须执行remove操作，否则报错（Tomcat底层使用了线程池技术）</span></span><br><span class="line">        conns.remove();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//回滚事务并关闭连接</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">rollbackAndClose</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Connection conn = conns.get();</span><br><span class="line">        <span class="keyword">if</span> (conn != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                conn.rollback();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">                throwables.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    conn.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">                    throwables.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        conns.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>删除BaseDao所有方法的finally语句块，上抛异常：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">	e.printStackTrace();</span><br><span class="line">	<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用Filter给所有Service加上try-catch：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransactionFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">            JdbcUtils.commitAndClose();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            JdbcUtils.rollbackAndClose();</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置web.xml：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>TransactionFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>filter.TransactionFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>TransactionFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--过滤工程下所有资源--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>把BaseServlet的异常抛给Filter：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">	e.printStackTrace();</span><br><span class="line">	<span class="comment">//把异常抛给Filter</span></span><br><span class="line">	<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="让Tomcat展示错误信息页面"><a href="#让Tomcat展示错误信息页面" class="headerlink" title="让Tomcat展示错误信息页面"></a>让Tomcat展示错误信息页面</h4><p>在web.xml中配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--error-page配置服务器出错后自动跳转的页面--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--错误类型--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">error-code</span>&gt;</span>500<span class="tag">&lt;/<span class="name">error-code</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--出错后跳转的路径--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">location</span>&gt;</span>/pages/error/error500.jsp<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">error-code</span>&gt;</span>404<span class="tag">&lt;/<span class="name">error-code</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">location</span>&gt;</span>/pages/error/error404.jsp<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在TransactionFilter中上抛异常给Tomcat：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">	JdbcUtils.rollbackAndClose();</span><br><span class="line">	e.printStackTrace();</span><br><span class="line">	<span class="comment">//上抛异常给Tomcat</span></span><br><span class="line">	<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="十-使用AJAX"><a href="#十-使用AJAX" class="headerlink" title="十. 使用AJAX"></a>十. 使用AJAX</h3><h4 id="使用AJAX验证用户名是否可用"><a href="#使用AJAX验证用户名是否可用" class="headerlink" title="使用AJAX验证用户名是否可用"></a>使用AJAX验证用户名是否可用</h4><p>UserServlet中添加ajaxExistsUsername方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">ajaxExistsUsername</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">	<span class="comment">//获取请求参数username</span></span><br><span class="line">	String username = req.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">	<span class="comment">//调用userService.existsUsername方法</span></span><br><span class="line">	<span class="keyword">boolean</span> exists = userService.existUsername(username);</span><br><span class="line">	<span class="comment">//把返回结果封装成map对象</span></span><br><span class="line">	Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">	map.put(<span class="string">&quot;exists&quot;</span>, exists);</span><br><span class="line">	Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">	String json = gson.toJson(map);</span><br><span class="line">	resp.getWriter().write(json);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改regist.jsp：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用ajax验证用户名是否可用</span></span><br><span class="line">$(<span class="string">&quot;#username&quot;</span>).blur(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="comment">//获取用户名</span></span><br><span class="line">	<span class="keyword">var</span> username = <span class="built_in">this</span>.value;</span><br><span class="line">	$.getJSON(<span class="string">&quot;http://localhost:8080/book/userServlet&quot;</span>, <span class="string">&quot;action=ajaxExistsUsername&amp;username=&quot;</span> + username, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (data.exists)&#123;</span><br><span class="line">			$(<span class="string">&quot;span.errorMsg&quot;</span>).text(<span class="string">&quot;用户名已存在&quot;</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			$(<span class="string">&quot;span.errorMsg&quot;</span>).text(<span class="string">&quot;用户名可用&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="使用AJAX修改添加商品到购物车"><a href="#使用AJAX修改添加商品到购物车" class="headerlink" title="使用AJAX修改添加商品到购物车"></a>使用AJAX修改添加商品到购物车</h4><p>CartServlet中添加ajaxAddItem方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">ajaxExistsUsername</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">	<span class="comment">//获取请求参数username</span></span><br><span class="line">	String username = req.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">	<span class="comment">//调用userService.existsUsername方法</span></span><br><span class="line">	<span class="keyword">boolean</span> exists = userService.existUsername(username);</span><br><span class="line">	<span class="comment">//把返回结果封装成map对象</span></span><br><span class="line">	Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">	map.put(<span class="string">&quot;exists&quot;</span>, exists);</span><br><span class="line">	Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">	String json = gson.toJson(map);</span><br><span class="line">	resp.getWriter().write(json);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改client/index.jsp：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;div style=<span class="string">&quot;text-align: center&quot;</span>&gt;</span><br><span class="line">	&lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;empty sessionScope.cart.items&#125;&quot;</span>&gt;</span><br><span class="line">		&lt;%--购物车为空--%&gt;</span><br><span class="line">		&lt;span id=&quot;cartTotalCount&quot;&gt; &lt;/span&gt;</span><br><span class="line">		&lt;div&gt;</span><br><span class="line">			&lt;span style=&quot;color: red&quot; id=&quot;cartLastName&quot;&gt;当前购物车为空&lt;/span&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">	&lt;/c:if&gt;</span><br><span class="line">	&lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;not empty sessionScope.cart.items&#125;&quot;</span>&gt;</span><br><span class="line">		&lt;%--购物车不为空--%&gt;</span><br><span class="line">		&lt;span id=&quot;cartTotalCount&quot;&gt;您的购物车中有$&#123;sessionScope.cart.totalCount&#125;件商品&lt;/span&gt;</span><br><span class="line">		&lt;div&gt;</span><br><span class="line">			您刚刚将&lt;span style=&quot;color: red&quot; id=&quot;cartLastName&quot;&gt;$&#123;sessionScope.lastName&#125;&lt;/span&gt;加入到了购物车中</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">	&lt;/c:if&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;button.addToCart&quot;</span>).click(function () &#123;</span><br><span class="line">	<span class="keyword">var</span> bookId = $(<span class="keyword">this</span>).attr(<span class="string">&quot;bookId&quot;</span>);</span><br><span class="line">	<span class="comment">//使用ajax请求添加商品到购物车</span></span><br><span class="line">	$.getJSON(<span class="string">&quot;cartServlet&quot;</span>, <span class="string">&quot;action=ajaxAddItem&amp;id=&quot;</span> + bookId, function (data) &#123;</span><br><span class="line">		$(<span class="string">&quot;#cartTotalCount&quot;</span>).text(<span class="string">&quot;您购物车中有&quot;</span> + data.totalCount + <span class="string">&quot;件商品&quot;</span>);</span><br><span class="line">		$(<span class="string">&quot;#cartLastName&quot;</span>).text(data.lastName);</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

</div><div class="post-copyright"><blockquote><p>Original author: Liu Sai</p><p>Original link: <a href="http://example.com/2021/05/08/尚硅谷书城项目/">http://example.com/2021/05/08/尚硅谷书城项目/</a></p><p>Copyright Notice: Please indicate the source of the reprint (must retain the author's signature and link)</p></blockquote></div><div class="tags"><a href="/tags/%E5%B0%9A%E7%A1%85%E8%B0%B7%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE/">尚硅谷书城项目</a></div><div class="post-share"><div class="social-share"><span>Share:</span></div></div><div class="post-nav"><a href="/2021/05/08/JavaWeb%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9AXML%E3%80%81Servlet%E3%80%81jsp%E3%80%81EL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E3%80%81JSTL%E6%A0%87%E7%AD%BE%E5%BA%93/" class="pre">JavaWeb（二）：XML、Servlet、jsp、EL表达式、JSTL标签库</a><a href="/2021/04/13/JavaWeb%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9AHTML%E3%80%81CSS%E3%80%81JavaScript%E3%80%81jQuery/" class="next">JavaWeb（一）：HTML、CSS、JavaScript、jQuery</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">Contents</i></div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80-%E8%A1%A8%E5%8D%95%E9%AA%8C%E8%AF%81"><span class="toc-text">一. 表单验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%E5%92%8C%E7%99%BB%E5%BD%95"><span class="toc-text">二. 用户注册和登录</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E5%B7%A5%E5%85%B7%E7%B1%BBJdbcUtils"><span class="toc-text">编写工具类JdbcUtils</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99BaseDao"><span class="toc-text">编写BaseDao</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99UserDao%E6%8E%A5%E5%8F%A3"><span class="toc-text">编写UserDao接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99UserService%E6%8E%A5%E5%8F%A3"><span class="toc-text">编写UserService接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99web%E5%B1%82%EF%BC%9A%E5%AE%9E%E7%8E%B0%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%E5%8A%9F%E8%83%BD"><span class="toc-text">编写web层：实现用户注册功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD"><span class="toc-text">实现用户登录功能</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89-%E9%A1%B9%E7%9B%AE%E4%BC%98%E5%8C%96"><span class="toc-text">三. 项目优化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%BD%E5%8F%96%E9%A1%B5%E9%9D%A2%E4%B8%AD%E7%9B%B8%E5%90%8C%E5%86%85%E5%AE%B9"><span class="toc-text">抽取页面中相同内容</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF%E6%8F%90%E7%A4%BA%E5%8F%8A%E8%A1%A8%E5%8D%95%E5%9B%9E%E6%98%BE"><span class="toc-text">错误信息提示及表单回显</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%88%E5%B9%B6LoginServlet%E5%92%8CRegistServlet%E4%B8%BAUserServlet"><span class="toc-text">合并LoginServlet和RegistServlet为UserServlet</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%8D%E5%B0%84%E4%BC%98%E5%8C%96UserServlet%E4%B8%AD%E7%9A%84else-if%E4%BB%A3%E7%A0%81"><span class="toc-text">使用反射优化UserServlet中的else if代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%BD%E5%8F%96BaseServlet%E7%A8%8B%E5%BA%8F"><span class="toc-text">抽取BaseServlet程序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%9A%84%E5%B0%81%E8%A3%85%E5%92%8CBeanUtils%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">数据的封装和BeanUtils的使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8EL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E4%BF%AE%E6%94%B9%E8%A1%A8%E5%8D%95%E5%9B%9E%E6%98%BE"><span class="toc-text">使用EL表达式修改表单回显</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B-%E5%9B%BE%E4%B9%A6%E6%A8%A1%E5%9D%97"><span class="toc-text">四. 图书模块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%BC%96%E5%86%99%E5%9B%BE%E4%B9%A6%E6%A8%A1%E5%9D%97%E6%95%B0%E6%8D%AE%E5%BA%93%E3%80%81%E8%A1%A8"><span class="toc-text">1.编写图书模块数据库、表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E5%9B%BE%E4%B9%A6%E6%A8%A1%E5%9D%97%E7%9A%84JavaBean"><span class="toc-text">编写图书模块的JavaBean</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E5%9B%BE%E4%B9%A6%E6%A8%A1%E5%9D%97%E7%9A%84Dao%E4%B8%8E%E6%B5%8B%E8%AF%95"><span class="toc-text">编写图书模块的Dao与测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E5%9B%BE%E4%B9%A6%E6%A8%A1%E5%9D%97Service%E4%B8%8E%E6%B5%8B%E8%AF%95"><span class="toc-text">编写图书模块Service与测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99Web%E5%B1%82"><span class="toc-text">编写Web层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%9B%BE%E4%B9%A6"><span class="toc-text">添加图书</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%9B%BE%E4%B9%A6"><span class="toc-text">删除图书</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%9B%BE%E4%B9%A6%E4%BF%A1%E6%81%AF"><span class="toc-text">修改图书信息</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94-%E5%9B%BE%E4%B9%A6%E5%88%86%E9%A1%B5"><span class="toc-text">五. 图书分页</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A6%96%E9%A1%B5index-jsp%E7%9A%84%E8%B7%B3%E8%BD%AC"><span class="toc-text">首页index.jsp的跳转</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E6%9D%A1%E7%9A%84%E6%8A%BD%E5%8F%96"><span class="toc-text">分页条的抽取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%B7%E6%A0%BC%E6%90%9C%E7%B4%A2%E6%A8%A1%E5%9D%97"><span class="toc-text">价格搜索模块</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AD-%E7%94%A8%E6%88%B7%E7%99%BB%E9%99%86%E3%80%81%E6%B3%A8%E9%94%80%E3%80%81%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-text">六. 用户登陆、注销、验证码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E5%90%8E%E6%98%BE%E7%A4%BA%E7%94%A8%E6%88%B7%E5%90%8D%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-text">登录后显示用户名功能实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E9%94%80%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-text">注销功能实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E7%A0%81%E8%A7%A3%E5%86%B3%E8%A1%A8%E5%8D%95%E9%87%8D%E5%A4%8D%E6%8F%90%E4%BA%A4"><span class="toc-text">验证码解决表单重复提交</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%83-%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="toc-text">七. 购物车</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A0%E5%85%A5%E8%B4%AD%E7%89%A9%E8%BD%A6%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-text">加入购物车功能实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B4%AD%E7%89%A9%E8%BD%A6%E5%95%86%E5%93%81%E5%B1%95%E7%A4%BA"><span class="toc-text">购物车商品展示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%B4%AD%E7%89%A9%E8%BD%A6%E5%95%86%E5%93%81%E9%A1%B9"><span class="toc-text">删除购物车商品项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B8%85%E7%A9%BA%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="toc-text">清空购物车</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%B4%AD%E7%89%A9%E8%BD%A6%E5%95%86%E5%93%81%E6%95%B0%E9%87%8F"><span class="toc-text">修改购物车商品数量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A6%96%E9%A1%B5%E8%B4%AD%E7%89%A9%E8%BD%A6%E6%95%B0%E6%8D%AE%E5%9B%9E%E6%98%BE"><span class="toc-text">首页购物车数据回显</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AB-%E8%AE%A2%E5%8D%95"><span class="toc-text">八. 订单</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E8%AE%A2%E5%8D%95"><span class="toc-text">生成订单</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B9%9D-%E5%90%8E%E5%8F%B0%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="toc-text">九. 后台权限管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Filter%E5%92%8CThreadLocal%E7%BB%84%E5%90%88%E7%AE%A1%E7%90%86%E4%BA%8B%E5%8A%A1"><span class="toc-text">使用Filter和ThreadLocal组合管理事务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A9Tomcat%E5%B1%95%E7%A4%BA%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF%E9%A1%B5%E9%9D%A2"><span class="toc-text">让Tomcat展示错误信息页面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%81-%E4%BD%BF%E7%94%A8AJAX"><span class="toc-text">十. 使用AJAX</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8AJAX%E9%AA%8C%E8%AF%81%E7%94%A8%E6%88%B7%E5%90%8D%E6%98%AF%E5%90%A6%E5%8F%AF%E7%94%A8"><span class="toc-text">使用AJAX验证用户名是否可用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8AJAX%E4%BF%AE%E6%94%B9%E6%B7%BB%E5%8A%A0%E5%95%86%E5%93%81%E5%88%B0%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="toc-text">使用AJAX修改添加商品到购物车</span></a></li></ol></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2021/09/11/JVM/">JVM</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/08/23/%E7%A4%BE%E5%8C%BA%E9%A1%B9%E7%9B%AE%EF%BC%88%E4%B8%8B%EF%BC%89/">社区项目（下）</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/07/09/%E7%A4%BE%E5%8C%BA%E9%A1%B9%E7%9B%AE%EF%BC%88%E4%B8%8A%EF%BC%89/">社区项目（上）</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/06/27/SpringMVC/">SpringMVC</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/06/20/Maven/">Maven</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/06/19/MyBatis/">MyBatis</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/06/05/Spring/">Spring</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/05/21/JavaWeb%EF%BC%88%E4%B8%89%EF%BC%89%EF%BC%9ACookie%E3%80%81Session%E3%80%81Filter%E3%80%81JSON%E3%80%81AJAX/">JavaWeb（三）：Cookie、Session、Filter、JSON、AJAX</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/05/08/JavaWeb%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9AXML%E3%80%81Servlet%E3%80%81jsp%E3%80%81EL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E3%80%81JSTL%E6%A0%87%E7%AD%BE%E5%BA%93/">JavaWeb（二）：XML、Servlet、jsp、EL表达式、JSTL标签库</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/05/08/%E5%B0%9A%E7%A1%85%E8%B0%B7%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE/">尚硅谷书城项目</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> Tags</i></div><div class="tagcloud"><a href="/tags/JDBC/" style="font-size: 15px;">JDBC</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Maven/" style="font-size: 15px;">Maven</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/JavaWeb/" style="font-size: 15px;">JavaWeb</a> <a href="/tags/MyBatis/" style="font-size: 15px;">MyBatis</a> <a href="/tags/Spring/" style="font-size: 15px;">Spring</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/SpringMVC/" style="font-size: 15px;">SpringMVC</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 15px;">数据结构</a> <a href="/tags/JVM/" style="font-size: 15px;">JVM</a> <a href="/tags/%E5%B0%9A%E7%A1%85%E8%B0%B7%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE/" style="font-size: 15px;">尚硅谷书城项目</a> <a href="/tags/%E7%A4%BE%E5%8C%BA%E9%A1%B9%E7%9B%AE/" style="font-size: 15px;">社区项目</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> Archive</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/">2021</a><span class="archive-list-count">17</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020</a><span class="archive-list-count">11</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> Blogroll</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">Site Map</a> |  <a href="/atom.xml">Subscribe to this site</a> |  <a href="/about/">Contact the blogger</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次，本站总访客数:<i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>人</p><p><span> Copyright &copy;<a href="/." rel="nofollow">Liu Sai.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a target="_blank" rel="noopener" href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.5"></script><div id="fullscreen-img" class="hide"><span class="close"></span></div><script type="text/javascript" src="/js/imgview.js?v=2.0.5" async></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.5" async></script><link rel="stylesheet" type="text/css" href="/share/css/share.css"><script type="text/javascript" src="/share/js/social-share.js" charset="utf-8"></script><script type="text/javascript" src="/share/js/qrcode.js" charset="utf-8"></script></body></html>